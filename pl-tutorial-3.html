<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-02-15 Sat 20:20 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PL教程 第三章 (未完)</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" type="text/css" href="css/worg.css"/>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">PL教程 第三章 (未完)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf52f7d5">手拉手</a></li>
<li><a href="#orgfc569ea">集齐多米诺骨牌⏎</a></li>
<li><a href="#org1cc5e47">┗&gt;&gt; 即可召唤魔法⏎</a></li>
</ul>
</div>
</div>
<p>
(话说我打算逐步地讲如何编各种小游戏，然后知识点穿插在里面。这样应该会轻松一些吧。就这么决定了。)
</p>

<div id="outline-container-orgf52f7d5" class="outline-2">
<h2 id="orgf52f7d5">手拉手</h2>
<div class="outline-text-2" id="text-orgf52f7d5">
<p>
来接触一个新的定义，它表示平面里一个位置的坐标。(我是在为编游戏做铺垫了)
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">struct</span> posn <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">position</span>
  <span style="color: #93a8c6;">(</span>x y<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
我们定义了一个 <code>struct</code>，意为结构体，名叫 <code>posn</code>，之后跟着一对括号，括号里为结构体存储的内容 <code>x</code> 和 <code>y</code>。</p>

<p>
实际上，我们写下这句话的时候，程序就为我们自动定义了一堆函数。首先，定义了一个同名的函数，就叫 <code>posn</code>，它用来创建一个 <code>posn</code> 结构。(这个函数的名字和结构体的名字相同，有误导性，我觉得是个设计错误，请自己分清楚吧)
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>posn <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#19968;&#20010;&#20301;&#20110;(1,2)&#30340;&#22352;&#26631;&#28857;</span>
#&lt;posn&gt;
</pre>
</div>
<p>
用 <code>posn-x</code> 和 <code>posn-y</code> 来拆开这个结构体，获得内部信息。用 <code>posn?</code> 来判断它是否为一个 <code>posn</code> 结构体。这些函数都是电脑自动帮我们定义的。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">p</span> <span style="color: #93a8c6;">(</span>posn <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>posn-x p<span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>posn-y p<span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">2</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>posn? p<span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">#t</span>
</pre>
</div>
<p>
我再举几个简单的例子。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">posn-abs</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">distance to (0,0)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>p<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">sqrt</span> <span style="color: #97b098;">(</span><span style="color: #262680;">+</span> <span style="color: #aebed8;">(</span><span style="color: #262680;">sqr</span> <span style="color: #b0b0b3;">(</span>posn-x p<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
             <span style="color: #aebed8;">(</span><span style="color: #262680;">sqr</span> <span style="color: #b0b0b3;">(</span>posn-y p<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">posn+</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">add two 'posn's</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>p1 p2<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>posn <span style="color: #97b098;">(</span><span style="color: #262680;">+</span> <span style="color: #aebed8;">(</span>posn-x p1<span style="color: #aebed8;">)</span>
             <span style="color: #aebed8;">(</span>posn-x p2<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
          <span style="color: #97b098;">(</span><span style="color: #262680;">+</span> <span style="color: #aebed8;">(</span>posn-y p1<span style="color: #aebed8;">)</span>
             <span style="color: #aebed8;">(</span>posn-y p2<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">posn-</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">subtract two 'posn's</span>
  ....<span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&lt;= as exercise</span>

<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">distance</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>p1 p2<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>posn-abs <span style="color: #97b098;">(</span>posn- p1 p2<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
你可以体会一下我是怎么用 <code>posn-abs</code> 和 <code>posn-</code> 组合成 <code>distance</code> 的。</p>

<p>
先稍微总结一下，我们前两章学了通过函数组合出一个程序，我们说这叫“函数抽象”，现在我们又接触到了新的名词，叫“数据抽象(data abstraction)”。理解起来就是，一个 <code>struct</code> 是对数据的包装，就像函数是对程序逻辑的包装，我们要写上面那些跟 <code>posn</code> 有关的函数，当然可以不用定义 <code>struct</code>,
传递参数的时候就分别传递横、纵坐标，比如
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>posn+ <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">100</span> <span style="color: #228b22;">200</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">101</span>
<span style="color: #228b22;">202</span>
</pre>
</div>
<p>
(先偷偷说一声，Racket 函数是可以返回多个值的)<br />
但看起来实在是一团凌乱。四个参数加两个返回值，这是给人看的吗。<br />
我高度近视，你知道的。</p>

<p>
其实只要提供极少的数据结构，所有的程序就都能写了，只不过谁也不想看到本来一个简单的结构变成了一堆参数，还看不清楚它们都是干什么的。这是 <code>struct</code> 最基本的应用。但接下来就是一个颠覆一般人世界观的东西了(至少对我而言是这样，就是我前面说的第一次让我对编程感兴趣的东西，做好准备吧)
</p>

<hr />

<p>
嗯，受到我看的编程书的影响，我继续拿吃的来举例吧。</p>

<p>
假设我们为某个餐厅写一个点菜的程序，你当做我们是在编游戏也没问题。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">a menu of dishes</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">pizza</span> <span style="color: #228b22;">"pizza"</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">rice</span> <span style="color: #228b22;">"rice"</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">salad</span> <span style="color: #228b22;">"vegetable salad"</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">juice</span> <span style="color: #228b22;">"orange juice"</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #262680;">struct</span> order
  <span style="color: #93a8c6;">(</span>table-ID dish<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">an example</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>order <span style="color: #228b22;">123</span> pizza<span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">guests at table 123 ordered a pizza</span>
#&lt;order&gt;
</pre>
</div>
<p>
这应该是没问题的，接下来就有难题了。</p>

<p>
一般来讲你去饭店是不会只点一道菜的，除非你说，“我的饭店的特色就是一桌只有一道菜，但一个 pizza 里包含了世界上所有的菜。”
以后要是你们中的谁开了一家这样的饭店，别忘了给我付版权费。</p>

<p>
作为一家没什么创意的饭店，我们不得不满足各种顾客的需求
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">struct</span> order
  <span style="color: #93a8c6;">(</span>table-ID dish1 dish2 dish3 dish4<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
但理论上我们永远不能靠这样来解决问题。你可能觉得 4 个还不够，随着菜的数量增加，要再写 <code>dish5</code>, <code>dish6</code> ……
甚至可能会一路写到 <code>dish100</code>.
</p>

<p>
其实麻烦还不止这些，当你把这个订单发给厨师以后，厨师会发现他要反复调用
<code>order-dish1</code>, <code>order-dish2</code>, <code>order-dish3</code> ……
然后才能拿到所有点的菜。而且，从电脑的角度来说，大多数的订单并没有 100 道菜都点满，多数时候都有八九十道菜的内存是浪费的。</p>

<p>
所以这条路应该是行不通的。我们的思路是要做到支持任意道菜。</p>

<p>
请见下面这个结构
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">struct</span> dish-null <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">end of dish-list</span>
  <span style="color: #93a8c6;">()</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #262680;">struct</span> dish-list
  <span style="color: #93a8c6;">(</span>dish <span style="color: #262680;">rest</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">'rest' is a dish-list or dish-null</span>

<span style="color: #8c8c8c;">(</span><span style="color: #262680;">struct</span> order
  <span style="color: #93a8c6;">(</span>table-ID dishes<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">'dishes' is a dish-list</span>
</pre>
</div>
<p>
你可能比我聪明得多，所以不像我当时那么吃惊，或者你可能什么都没看出来，我们只是定义了 <code>dish-list</code> 和 <code>dish-null</code> 结构，<code>dish-list</code> 看起来再普通不过了，而 <code>dish-null</code> 有点奇怪，是个空的结构。神奇的就在于如何把它们组合起来。</p>

<p>
先看一遍代码的注释。<code>dish-list</code> 就是我们想要的，可以存放任意个 <code>dish</code> 的结构。可是它只有两个参数？没关系。请回答，下面这段代码表示什么？</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>dish-null<span style="color: #8c8c8c;">)</span>
#&lt;dish-list&gt;
</pre>
</div>
<p>
答: 一个空的订单，什么都没有。</p>

<p>
下面这个呢?
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>dish-list pizza <span style="color: #93a8c6;">(</span>dish-null<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
#&lt;dish-list&gt;
</pre>
</div>
<p>
答: 一个只点了一个 <code>pizza</code> 的订单。</p>

<p>
大胆猜想，</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>dish-list pizza
             <span style="color: #93a8c6;">(</span>dish-list salad
                        <span style="color: #b0b1a3;">(</span>dish-null<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
答: 一个点了 <code>pizza</code> 和 <code>salad</code> 的订单。</p>

<p>
以此类推，</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>dish-list
   pizza
   <span style="color: #93a8c6;">(</span>dish-list
    salad
    <span style="color: #b0b1a3;">(</span>dish-list
     juice
     <span style="color: #97b098;">(</span>dish-list
      salad
      <span style="color: #aebed8;">(</span>dish-null<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
答: 一个包含一份 <code>pizza</code>, 两份 <code>salad</code> 和一份 <code>juice</code> 的订单。</p>

<hr />

<p>
我们来试着画出一个 <code>struct</code> 吧。</p>

<p>
比方说，先试一下画出一个 <code>dish-list</code> 大致的结构
</p>


<div class="figure">
<p><img src="./img/plt3/dish-list-struct.png" alt="dish-list-struct.png" />
</p>
</div>

<p>
(因为它并不是一个函数(虽然有一个同名的函数叫 <code>dish-list</code> )，所以我暂且用圆角的长方形来表示它)
</p>

<p>
一个 <code>dish-null</code> 就很简单，什么都没有
</p>


<div class="figure">
<p><img src="./img/plt3/dish-null-struct.png" alt="dish-null-struct.png" />
</p>
</div>

<p>
那么 <code>(dish-list pizza (dish-null))</code> 就是
</p>


<div class="figure">
<p><img src="./img/plt3/pizza-dish.png" alt="pizza-dish.png" />
</p>
</div>

<p>
类似的，一个 <code>(dish-list pizza (dish-list salad (dish-null)))</code> 就是
</p>


<div class="figure">
<p><img src="./img/plt3/pizza-salad-dish.png" alt="pizza-salad-dish.png" />
</p>
</div>

<p>
以此类推，我懒得画了。</p>

<p>
因为嵌套的结构太多，所以为了简单我们一般这样画
</p>


<div class="figure">
<p><img src="./img/plt3/linked-pizza-salad-dish.png" alt="linked-pizza-salad-dish.png" />
</p>
</div>

<p>
所以我们已经学会如何创造一份订单了！下面的问题是如何使用它
</p>

<p>
根据我们对 <code>struct</code> 的学习，我们定义一个结构体为 <code>dish-list</code> 时，我们就自动定义了一些函数来创建和拆开这个 <code>struct</code>
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">struct</span> dish-list
  <span style="color: #93a8c6;">(</span>dish <span style="color: #262680;">rest</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">x</span> <span style="color: #93a8c6;">(</span>dish-list <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>dish-list-dish x<span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>dish-list-rest x<span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">2</span>
</pre>
</div>
<p>
(虽然不得不说，我觉得这个起名方式怪怪的，特别是那个 <code>dish-list-dish</code>.
不过你喜欢的话，完全可以用 <code>define</code> 给它另起一个名字)
</p>

<p>
如何使用这些函数呢? 首先，我们可以用 <code>dish-list-dish</code> 函数来拿到第一道菜
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">d</span>
  <span style="color: #93a8c6;">(</span>dish-list
   pizza
   <span style="color: #b0b1a3;">(</span>dish-list
    salad
    <span style="color: #97b098;">(</span>dish-null<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>dish-list-dish d<span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">"pizza"</span>
</pre>
</div>
<p>
接下来，用 <code>dish-list-rest</code> 就能拿到剩下的订单，而结构是一模一样的。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">d-rest</span> <span style="color: #93a8c6;">(</span>dish-list-rest d<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">d-rest = (dish-list salad (dish-null))</span>
</pre>
</div>
<p>
所以，重复上述过程。再用 <code>dish-list-dish</code> 来得到 <code>d-rest</code> 中的第一道菜
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>dish-list-dish d-rest<span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">"vegetable salad"</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>dish-list-rest d-rest<span style="color: #8c8c8c;">)</span>
#&lt;dish-null&gt;
</pre>
</div>
<p>
如果菜单很长，就可以一直重复这个过程:<br />
</p>
<ol class="org-ol">
<li>用 <code>dish-list-dish</code> 拿到当前的第一个菜</li>
<li>用 <code>dish-list-rest</code> 拿到剩余的菜单</li>
<li>重复这个过程</li>
</ol>

<p>
一直重复下去，总有一次会得到一个 <code>dish-null</code> 而不是 <code>dish-list</code>
</p>

<p>
于是这就表示已经没有更多的菜了，我们就停止循环。</p>

<p>
这个过程让你想到了什么?
</p>

<hr />

<p>
这又是上一章学过的递归。</p>

<p>
我们对这个菜单能干些什么呢?
首先，除了把它的内容一个个拿出来以外，比方说，先数一数总共有几道菜。</p>

<p>
写出函数 <code>dish-list-length</code>, 输入一个 <code>dish-list</code>, 输出它共有多少道菜。</p>

<p>
下面是大致的框架
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">dish-list-length</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>dishes<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">if</span> <span style="color: #97b098;">(</span>dish-null? dishes<span style="color: #97b098;">)</span>
        ___
        <span style="color: #97b098;">(</span>___ <span style="color: #aebed8;">(</span>dish-list-length
              <span style="color: #b0b0b3;">(</span>dish-list-rest dishes<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
练习题: 请填空
</p>

<hr />

<p>
首先，如果 <code>dishes</code> 是空的，那答案就是 0，很简单
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">if</span> <span style="color: #93a8c6;">(</span>dish-null? dishes<span style="color: #93a8c6;">)</span>
    <span style="color: #228b22;">0</span>
    ....<span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
否则，我们就取出第一个 <code>dish</code>，然后递归计算剩余的长度，再把它加 1
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #93a8c6;">(</span>dish-list-length
      <span style="color: #b0b1a3;">(</span>dish-list-rest dishes<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
就这么完成了。如果你上一章学得比较好，这里应该是没有任何问题的。</p>

<p>
你是否想到了上一章中的 <code>count-digits</code>？就是计算一个数有多少位数字的函数。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">count-digits</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>n<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">if</span> <span style="color: #97b098;">(</span>single-digit? n<span style="color: #97b098;">)</span>
        <span style="color: #228b22;">1</span>
        <span style="color: #97b098;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #aebed8;">(</span>count-digits
              <span style="color: #b0b0b3;">(</span>delete-units-digit n<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
它们是不是几乎一模一样？</p>

<p>
我们把它改一改
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">zero?</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>n<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">=</span> n <span style="color: #228b22;">0</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">count-digits</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>n<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">if</span> <span style="color: #97b098;">(</span><span style="color: #262680;">zero?</span> n<span style="color: #97b098;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#20010;&#20301;&#25968;&#20877;&#21024;&#25481;&#19968;&#20301;&#25968;&#23383;&#65292;&#23601;&#21464;&#25104;&#20102; 0</span>
        <span style="color: #228b22;">0</span>
        <span style="color: #97b098;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #aebed8;">(</span>count-digits
              <span style="color: #b0b0b3;">(</span>delete-units-digit n<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">compare with</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">dish-list-length</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>dishes<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">if</span> <span style="color: #97b098;">(</span><span style="color: #262680;">null?</span> dishes<span style="color: #97b098;">)</span>
        <span style="color: #228b22;">0</span>
        <span style="color: #97b098;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #aebed8;">(</span>dish-list-length
              <span style="color: #b0b0b3;">(</span>dish-list-rest dishes<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
这下真的一模一样了，发现了没？他们都是计算一个东西的长度。</p>

<p>
上一章，我们已经跟“数字列表”玩耍过，用 <code>add-what</code> 加上一个数字，用 <code>get-units-digit</code> 和 <code>delete-units-digit</code> 分别取个位数字，和更高位的剩余数字。这就是我们对“数字列表”所需要的全部了。</p>

<p>
现在，我们又接触了“ <code>dish-list</code> ”，用 <code>dish-list</code> 这个函数，创建新的结构体，加上一个新 <code>dish</code>，用 <code>dish-list-dish</code> 和 <code>dish-list-rest</code> 分别取第一道 <code>dish</code>，和剩余的 <code>dish</code> 列表。这就是我们需要的全部了。</p>

<p>
只要你理解了其中之一，你就都可以理解了。</p>

<hr />

<p>
但我很不爽，遇见重复的东西，我就想要把它提出来，单独变成一个函数。比如我要计算任意东西的长度
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">any-length</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> ....<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
你可能不知道如何下手了。看清楚了
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">any-length</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x no-more? get-rest<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">if</span> <span style="color: #97b098;">(</span>no-more? x<span style="color: #97b098;">)</span>
        <span style="color: #228b22;">0</span>
        <span style="color: #97b098;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #aebed8;">(</span>any-length <span style="color: #b0b0b3;">(</span>get-rest x<span style="color: #b0b0b3;">)</span>
                         no-more?
                         get-rest<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
什么？后面两个 <code>no-more?</code> 和 <code>get-rest</code> 参数是什么玩意儿？</p>

<p>
首先，我们用了 <code>(no-more? x)</code> 和 <code>(get-rest x)</code>，也就是说，它们两个都是函数？</p>

<p>
没错。看看怎么用
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">dish-list-length</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>dishes<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>any-length dishes dish-null? dish-list-rest<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">count-digits</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>n<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>any-length n <span style="color: #262680;">zero?</span> delete-units-digit<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
够不够神奇？</p>

<p>
你能明白这是怎么回事吗？函数就跟其它的东西一样，可以作为其它函数的参数，然后在其它函数中被调用。</p>

<p>
上一节中，还有个 <code>first-digit</code> 函数，计算最高位的数字，我们试一下，能不能一模一样地，计算一个 <code>dish-list</code> 最后一道 <code>dish</code>。</p>

<p>
练习题: 写出 <code>last-dish</code> 函数。注意，这时候的判断条件就不是
<code>dish-null?</code> 了，因为要计算最后一道菜，那输入肯定是至少有一道菜的，不可能是个空的菜单，对吧。</p>

<hr />

<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">first-digit</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>n<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">if</span> <span style="color: #97b098;">(</span>single-digit? n<span style="color: #97b098;">)</span>
        n
        <span style="color: #97b098;">(</span>first-digit <span style="color: #aebed8;">(</span>delete-units-digit n<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>


<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">single-dish?</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>dishes<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>dish-null? <span style="color: #97b098;">(</span>dish-list-rest dishes<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">last-dish</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>dishes<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">if</span> <span style="color: #97b098;">(</span>single-dish? dishes<span style="color: #97b098;">)</span>
        <span style="color: #97b098;">(</span>dish-list-dish dishes<span style="color: #97b098;">)</span>
        <span style="color: #97b098;">(</span>last-dish <span style="color: #aebed8;">(</span>dish-list-rest dishes<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
好了，来仔细地比较一下。</p>

<p>
别的都没问题，唯一不同的是，当 <code>if</code> 条件成立的时候，前者是 <code>n</code>，后者是 <code>(dish-list-dish dishes)</code>，而不是简单的 <code>dishes</code>。我估计你自己做完这道题，要是没测试过的话，这里很有可能是写错的。</p>

<p>
其实也没错地很离谱，只不过我们再用 <code>dish-list-dish</code> 来获得一下那道
<code>dish</code> 就好了。所以，自己试试写个通用的函数。</p>

<hr />

<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">last-element</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x stop? get-rest<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">if</span> <span style="color: #97b098;">(</span>stop? x<span style="color: #97b098;">)</span>
        x
        <span style="color: #97b098;">(</span>last-element <span style="color: #aebed8;">(</span>get-rest x<span style="color: #aebed8;">)</span>
                      stop?
                      get-rest<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
(别忘了还要把 <code>stop?</code> 和 <code>get-rest</code> 原样递归进去，参数别漏了(这都是我自己犯过的错误啊))
</p>

<p>
练习题: 然后试试用它来定义 <code>first-digit</code> 和 <code>last-dish</code> 函数。</p>

<hr />

<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">first-digit</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>n<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>last-element n single-digit? delete-units-digit<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">last-dish</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>dishes<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">define</span> <span style="color: black;">one-dish-list</span>
      <span style="color: #97b098;">(</span>last-element dishes single-dish? dish-list-rest<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>dish-list-dish one-dish-list<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
我这里用了上一章最后讲的语法，就是函数中可以有内部的变量定义。我先计算了 <code>one-dish-list</code>，然后输出了 <code>(dish-list-dish one-dish-list)</code>
</p>

<p>
(当然也可以不定义这个变量，直接把函数套在一块儿。但我个人喜欢多定义一些变量，这样思考起来更清楚。就像我第一章里说的，变量在一定程度上，能起到注释的作用)
</p>

<hr />

<p>
怎么样，你没想到函数还能这么用吧。</p>

<p>
还有很多很多的函数给你做练习题。你可以准备一下。这一节就再做最后一道吧:<br />
写出函数 <code>dish-list-member?</code> 和 <code>digit-member?</code>，分别计算第一个参数(一道菜或一个一位数字)是否在第二个参数(列表)中。写出一个通用的函数 <code>any-member?</code> 来定义它们。(你可以看到这些结尾是问号的函数，返回值都是 <code>#t</code> 或 <code>#f</code>)
</p>

<p>
上一节中讲过，判断是否相等的函数是 <code>equal?</code>
</p>

<p>
一个 <code>if</code> 判断显然是不够用的。你可能要多分一类讨论，在 <code>if</code> 中再嵌套一个 <code>if</code>，请不要马上往下看，自己思考。</p>

<hr />

<p>
我就把 <code>any-member?</code> 给出来吧。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">any-member?</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">search x in ls</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x ls no-more? get-elem get-rest<span style="color: #b0b1a3;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">elem: element</span>

    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">define</span> <span style="color: black;">mem?</span>
      <span style="color: #97b098;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #aebed8;">(</span>x ls<span style="color: #aebed8;">)</span>
        <span style="color: #aebed8;">(</span><span style="color: #262680;">if</span> <span style="color: #b0b0b3;">(</span>no-more? ls<span style="color: #b0b0b3;">)</span>
            <span style="color: #228b22;">#f</span>
            <span style="color: #b0b0b3;">(</span><span style="color: #262680;">if</span> <span style="color: #90a890;">(</span><span style="color: #262680;">equal?</span> x <span style="color: #a2b6da;">(</span>get-elem ls<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
                <span style="color: #228b22;">#t</span>
                <span style="color: #90a890;">(</span>mem? x <span style="color: #a2b6da;">(</span>get-rest ls<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>

    <span style="color: #b0b1a3;">(</span>mem? x ls<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
这里因为不停地传的参数太多了，我就在内部定义了一个函数，让代码看起来更简单一点。</p>

<p>
当然这种函数已经是极限了(指它的参数个数)，基本上我已经快眼花了，快要记不住哪个参数在第几个位置了。我一般是不会写出这样的函数的。如果参数再多两个，在实际中遇到的话，我宁愿复制粘贴代码。因为如果提出来一个函数，反倒更看不清了，折腾这个通用的函数变成负担了，那还不如傻一点，老老实实一个一个写。</p>

<hr />

<p>
现在你已经见识到函数绝大部分的威力了，只是你可能还不是很得心应手。目前的重点就是，学习怎样用好函数提供的这些能力。</p>

<p>
函数永远是一个程序的中心。其它的东西都是死的，只有函数是活的。</p>

<p>
我扯一些题外话吧。为什么说人类的语言比其它动物的语言高级？我认为，因为人类的语言有动词。动词跟程序中的函数是同一个概念。所谓的主语、宾语，不过都是动词的参数而已。</p>

<p>
只有动词，能真正地造出任意复杂的句子，就像函数能任意地嵌套一样。当然，你也可以往名词上一个劲地叠形容词，但它造不出复杂的句子。每个人学英语的时候，都在语法上有一个难关，就是从句。从句能充当形容词，副词，名词，但充当不了动词，它们都是在为动词服务。</p>

<p>
所以学外语的时候，我认为背单词，重点在于动词。把动词用漂亮了，能完胜那些只会堆形容词和副词的人。(说不定这句话能对你的英语作文有帮助)
</p>

<p>
而且学起语法来就没什么难度了。你心里很清楚它们是什么样的成分，只不过程序语言比较高级，可以像一个图形一样嵌套，自然语言只能把这些“结构上”的东西都抹平，然后用一些助词什么的来表示，其实它们只不过是在模仿程序语言里自然而然的结构。</p>

<p>
我也不是说孰优孰劣，但我对语言的东西确实很感兴趣，我们是如何表达自己的意思的，我们是如何理解他人的信息的。</p>

<p>
有时候我会梦想，希望人类能像三体人那样有透明的思维，这样世界上就不会有语言存在了，大家都能互相理解了，真是个美好的世界。(另: 作为学过 程序+语言 的人，我能看出《三体》的无数 bug&#x2026;而且我一点也不喜欢这本书)
</p>

<p>
不过同时，你会发现个人不存在什么自由了。为什么呢，比如世界要毁灭了，需要牺牲你才可以拯救(这是什么中二情节)。你当然怕死，但是其它所有人的痛苦你都能感同身受，我认为，在这种情况下，你一定是很直接地选择自愿去死，而且并不会像地球的电影里拍的那样各种纠结、遗憾。</p>

<p>
这其实等于你的思维、情感，已经是整个人类的一部分，你是没有什么自我意识的，整个人类已经组成了一个超级大脑，他们会诞生出一个真正的集体意识。你以为是你做出的决定，其实是这个集体意识做出的决定。为了集体可以牺牲部分。你具有的自我意识可能只是一种错觉。</p>

<p>
(对于看过 Eva 的人，这就是那里面所说的人类补完计划。)
</p>

<p>
但人类有语言这个屏障，人是不可能理解他人的，人能不能理解自己都是个问题。这就是我这么希望研究语言的原因，自然语言，还有程序语言，音乐、美术的语言，甚至是电脑游戏的语言。我想找到那些能表达自己的东西，能在人之间建立起联系的东西。</p>

<p>
所以在这一系列教程的前言里，我最开头就放上了巴别塔的故事。就这么一点传说，当时却给了我很大的触动。</p>

<p>
但是问题也在于，这样世界真的会向美好的方向发展吗？现在信息技术发达多了，可以说，人类之间应该是联系更紧密了，所以人类应该更加互相理解了。</p>

<p>
我认为是这样的，人们更能互相理解了，至少沟通的手段多了。但是这跟人的幸福似乎是相反的，似乎人之间的联系能够增加多少，人类这个集体的意识也会相应增加，人似乎就更听从于集体的决定，承担为了集体而给自己带来的痛苦。</p>

<p>
你可以类比一下，你身上的每个细胞都像是一个独立的人，但是为了你的生存，它们不停的工作，甚至有的已经变异得认不出来了，就为了能让集体生存，要是这个集体死了，它们都会死。它们只能听从这个集体的意识，即使这会给它们带来痛苦。</p>

<p>
所以我们是不是应该对组成自己身体的任何一部分，稍微多关爱尊重一些？</p>

<p>
我不确定细胞也会有痛苦，至少它们的意识是跟我们完全不同的存在。但是可以猜想，如果人类这样发展下去，也许也会成为这样的一个整体，我们会诞生出整体的意识，人类在其中会失去自己，或者被免疫系统自动清理掉。</p>

<p>
如果想保持个人的自由，我认为发展应该是有限度的，人类之间的联系增加，人类整体的发展，都是以牺牲个人为代价的。</p>

<p>
但换个角度说，这也许又是人类进化的终极途径。试想一下，如果整个地球诞生出一个整体的意识，我们是它的细胞，这会是什么样子，我是无法想象的。</p>

<p>
也许我臆想的成分实在太多，但是不管怎么说，我始终都在矛盾之中。我觉得世界上的痛苦都是人际关系导致的，我指的不是简单的与人交往，而是所有人之间，有意无意的互相影响。如果从古至今只有我一个人的存在，我就不需要面对所有的这些问题。</p>

<p>
所以最一开始，单细胞生物诞生的时候，为什么它们要想到组合在一起，甘愿成为高级生命的一部分呢？为什么要牺牲自己来创造更高级的生命呢？世界上就自己一个细胞，快快乐乐地生存不好吗？</p>

<p>
还是说，真的还是有什么自然规律在支配这些吗？</p>

<p>
但是现在既然有这些问题了，交流似乎就是唯一解决问题的途径，交流都是通过各种形式的语言来完成。所以研究语言，似乎就可以解决我们所有的烦恼了。</p>

<p>
问题就是，这个解决的结果，到底是人类快乐地共同生活，还是人类已经不作为一个个体存在？</p>

<p>
也许两者都是，也无所谓快乐不快乐？</p>

<p>
是的，我研究的是程序语言，而且研究地挺深了，我也喜欢接触其它各种语言，比如日语，见<a href="./japanese-learning.html">此链接</a>。但在这期间，我也想了很多很多，我不知道这样的研究，和人类的发展，究竟会带来什么。我自己当然没有这么强的能力，让人类之间的联系获得巨大的进步，但是这样发展下去，总有一天会有这样的结果。人类以前认为发展是好的，现在认为在环保的前提下，发展是好的，有多少人明白发展到最后，到底会带来什么东西呢。在这之前，我们就一直这样研究下去吗。</p>
</div>
</div>

<div id="outline-container-orgfc569ea" class="outline-2">
<h2 id="orgfc569ea">集齐多米诺骨牌⏎</h2>
<div class="outline-text-2" id="text-orgfc569ea">
<p>
不行，我写教程还是要收一收，别的话还是放到博客的其它文章里再说吧。回归正题。</p>

<p>
因为“列表(list)”在程序中实在太常见了，特别是在初学的时候，所以 Racket 其实已经提供了相关的一系列函数。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> '<span style="color: #8c8c8c;">()</span>
'<span style="color: #8c8c8c;">()</span>
<span style="color: #262680;">&gt;</span> <span style="color: #262680;">null</span>
'<span style="color: #8c8c8c;">()</span>
</pre>
</div>
<p>
<code>null</code> 就是 Racket 提供的一个变量，它表示空列表。注意，它不是个函数，把它直接写出来就是空列表了。我也不清楚为什么不统一成函数，可能直接这么写比较方便吧。</p>

<p>
至于 <code>'()</code> 是什么，你可以类比一下字符串，比如 <code>""</code> 是空字符串，而 <code>'(</code> 一直到 <code>)</code> 就相当于那两个双引号，一个表示列表开始，一个表示列表结尾。只要在一个东西前面加个单引号 <code>'</code>，里面的东西就不会被当成程序了，而会变成一个列表。</p>

<p>
(我觉得这个语法有点难看，为什么不干脆用花括号 <code>{}</code> 呢？)
</p>

<p>
你可能已经被讲晕了，直接上例子吧
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cons</span> <span style="color: #228b22;">1</span> '<span style="color: #93a8c6;">()</span><span style="color: #8c8c8c;">)</span>
'<span style="color: #8c8c8c;">(</span><span style="color: #228b22;">1</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> '<span style="color: #8c8c8c;">(</span><span style="color: #228b22;">1</span><span style="color: #8c8c8c;">)</span>
'<span style="color: #8c8c8c;">(</span><span style="color: #228b22;">1</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
这是一个只含有 <code>1</code> 的列表。列表可以直接写出来 <code>'(1)</code>，也可以用 <code>cons</code> 函数，它的意思是 <code>construct</code>，就跟我们上一节中的 <code>dish-list</code> 用法一样，前一个参数是新列表的元素，后一个参数是旧列表。</p>

<p>
接下来继续
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cons</span> <span style="color: #228b22;">2</span> '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
'<span style="color: #8c8c8c;">(</span><span style="color: #228b22;">2</span> <span style="color: #228b22;">1</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cons</span> <span style="color: #228b22;">3</span> '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">2</span> <span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
'<span style="color: #8c8c8c;">(</span><span style="color: #228b22;">3</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">1</span><span style="color: #8c8c8c;">)</span>
....
</pre>
</div>
<p>
这样应该能看懂了。</p>

<p>
需要特别提醒一下的是，列表跟字符串不同。字符串跟程序是一点关系也没有的，比如 <code>"1"</code> 跟程序中的数字 <code>1</code> 毫无关系，顶多只是看起来长得像罢了。但列表 <code>'(1)</code> 中的 <code>1</code> 就是程序中的数字 <code>1</code>，我们把这个列表拆开之后，还能拿到这个数字 <code>1</code>。</p>

<p>
所以列表中也可以放任意的东西
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cons</span> <span style="color: #228b22;">"abc"</span> <span style="color: #262680;">null</span><span style="color: #8c8c8c;">)</span>
'<span style="color: #8c8c8c;">(</span><span style="color: #228b22;">"abc"</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cons</span> <span style="color: #228b22;">#t</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">cons</span> <span style="color: #228b22;">123</span> <span style="color: #262680;">null</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
'<span style="color: #8c8c8c;">(</span><span style="color: #228b22;">#t</span> <span style="color: #228b22;">123</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cons</span> '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span> <span style="color: #262680;">null</span><span style="color: #8c8c8c;">)</span>
'<span style="color: #8c8c8c;">(</span><span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#21015;&#34920;&#20013;&#30340;&#21015;&#34920;</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cons</span> '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span> '<span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span><span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
'<span style="color: #8c8c8c;">(</span><span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">(</span><span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
你可以自己在电脑上多玩一玩。</p>

<p>
当然还有把列表拆开的函数。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">car</span> '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">"what?"</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">"what?"</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cdr</span> '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">"what?"</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
'<span style="color: #8c8c8c;">()</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">car</span> '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cdr</span> '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
'<span style="color: #8c8c8c;">(</span><span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">car</span> '<span style="color: #93a8c6;">()</span><span style="color: #8c8c8c;">)</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">error</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cdr</span> '<span style="color: #93a8c6;">()</span><span style="color: #8c8c8c;">)</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">error</span>
</pre>
</div>
<p>
<code>car</code> (就读作小汽车的那个 car)，和 <code>cdr</code> (读作 could-er)，就是跟 <code>cons</code> 反着干的，它们分别取出 <code>cons</code> 的两个参数。</p>

<p>
(至于为什么要叫这两个名字，据说是四五十(还是五六十)年前的的故事了，在古老的传说中，有一个叫 Lisp 的语言，它是 Scheme 语言的前身，然后 Scheme 又是我们现在用的 Racket 的前身。在那个 Lisp 语言里，好像有两个什么东西叫做 ‘a’ 和 ‘d’，然后不知怎么就有了这两个函数名，然后就流传下来了&#x2026;)
</p>

<p>
(你要是不爽，可以用 <code>first</code> 和 <code>rest</code> 这两个函数，效果完全一样，是 Racket 帮你定义的别名，只是看上去没 <code>car</code> 和 <code>cdr</code> 高端罢了，每次写 <code>car</code> 和 <code>cdr</code>，我就觉得自己在写上个世纪五六十年代的代码，特别带劲儿)
</p>

<p>
(好了又扯多了)
</p>

<p>
最后，用 <code>null?</code> 可以判断一个列表是否为 <code>null</code>，与之相对应的，用 <code>cons?</code> 可以判断它是否是 不为 <code>null</code> 的列表，就是说，它是否是一个 <code>cons</code> 组成的。</p>

<p>
估计你真的晕了，再总结一下，<code>null</code>、<code>cons</code>、<code>car</code>、<code>cdr</code>、<code>null?</code>、<code>cons?</code>，就这些。</p>

<p>
下面你们就可以忘了 <code>dish-list</code> 和 <code>digit-list</code> 了，以后我们都只研究由 <code>null</code> 和 <code>cons</code> 组成的列表(<code>list</code>)。但前面的东西能告诉你 <code>list</code> 是怎么来的。</p>

<p>
练习题们: 试着用这些函数定义一下前面几节讲的函数。这几个函数就像加减乘除一样，会陪伴我们学编程的一生，你可以多写一些函数练练手。先不看那些通用的函数，自己重新写一遍下列函数，只需要处理由 <code>cons</code> 组成的列表就可以了。</p>
<ol class="org-ol">
<li><code>length</code>，计算一个列表的长度。</li>
<li><code>last</code>，返回列表的最后一个成员。</li>
<li><code>member?</code>，判断第一个参数是否在列表中。</li>
</ol>

<hr />

<p>
好了，继续，<code>member?</code> 里面用的是 <code>equal?</code> 来判断真假，还有比它更通用的，试着把参数 <code>x</code> 换成另一个参数 <code>pred?</code>，然后把函数中的 <code>equal?</code> 换成 <code>pred?</code>，(<code>predicate</code> 的缩写)，新的函数叫
<code>memf?</code> (f 是 function(函数)的意思)，说一说它有什么作用？</p>

<p>
比如
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">&gt;10?</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">&gt;</span> x <span style="color: #228b22;">10</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>memf? &gt;10? '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">#f</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>memf? &gt;10? '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">9</span> <span style="color: #228b22;">10</span> <span style="color: #228b22;">11</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">#t</span>
</pre>
</div>
<p>
提醒一下第一章就学过的内容，一个函数只是定义给了变量而已，所以不必定义 <code>&gt;10?</code> 这个变量，上面的代码可以写作
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>memf? <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">&gt;</span> x <span style="color: #228b22;">10</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
         '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">#f</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>memf? <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">&gt;</span> x <span style="color: #228b22;">10</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
         '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">9</span> <span style="color: #228b22;">10</span> <span style="color: #228b22;">11</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">#t</span>


<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">member?</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x lst<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>memf? <span style="color: #97b098;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #aebed8;">(</span>v<span style="color: #aebed8;">)</span> <span style="color: #aebed8;">(</span><span style="color: #262680;">equal?</span> x v<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
           lst<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
你可以随心所欲地使用 <code>λ</code>，把 <code>λ</code> 传来传去就是自然而然的事情一样。(这也是我选择 Racket 语言的原因，好多流行的语言都对函数有许多限制，让人觉得碍手碍脚的，只有 Racket(和少数语言，比如 Python)是真正的自由，这也是 Python 现在火起来的原因之一)
</p>

<p>
(而且 Python 在有些地方还比 Racket 好，但学到后面，写解释器的时候，你肯定就明白为什么我最后选择 Racket 了)
</p>

<p>
(所以说实话，现在推广学 Python 还是不错的，但问题是，根本就没那么多老师真正理解编程，我还没见过有课程是把最重要的知识:
函数调用，递归，列表等数据结构，之后就是程序的状态，然后是解释器，放在最前面先讲明白的。让学生花好多节课，背那些格式化字符串，还有各种循环语句，然后就是所谓的面向对象，几十节上百节课，背到最后，学生甚至连递归也不理解，更不要说闭包这种东西了)
</p>

<p>
(想知道“闭包(closure)”是什么？闭包就是函数代码+函数中引用的外部变量。所有的函数都是个闭包，这是第一章就应该能理解的内容了吧，函数不光要包含代码，还要保存它定义的时候，变量所在的位置。闭包就是这玩意。现在学了函数还能当参数传来传去，应该对它有更深的理解了。)
</p>

<p>
(又扯远了)
</p>

<p>
来吧，去 <a href="https://docs.racket-lang.org/reference/pairs.html">Racket 官方文档</a>上瞅一眼，什么函数都有。比如，把上面的 <code>memf?</code> 的返回值从布尔类型，改成第一个满足函数的元素，就是官方的 <code>findf</code>，比如 <code>(findf &gt;10? '(9 10 11 12)) =&gt; 11</code>
</p>

<p>
再找一个做练习题: 写出 <code>list-ref</code> 函数(<code>ref</code> 为 <code>reference</code> 的缩写)，参数为一个列表 <code>lst</code> 和一个自然数 <code>pos</code> (<code>position</code>)，返回第 <code>pos</code> 个元素。</p>

<p>
有一个有点摸不着头脑的地方，就是编程里的列表这类结构，都不是从 1 开始数的，而是从 0 开始数的。就是说，列表的第一个元素，在编程中叫做第 0 个元素。所以
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">list-ref</span> '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span> <span style="color: #228b22;">0</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">list-ref</span> '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span> <span style="color: #228b22;">1</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">2</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">list-ref</span> '<span style="color: #93a8c6;">(</span><span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span> <span style="color: #228b22;">2</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">3</span>
</pre>
</div>
<p>
别问我为什么，我也天天搞错这玩意。好像又是因为上古时代，大家还在写机器代码的时候，就是这么设计的。程序员数数也特别喜欢从 0 开始，就是数“自然数”，而不是“正整数”，应该也是受这个影响。比如阶乘函数，非要定义个 <code>(factorial 0) =&gt; 1</code>，这样就可以从 0 开始递归了。谁知道为什么。</p>

<p>
(不过说实话，在目前的电脑上，判断是否为 0，比判断是否为 1，好像效率高那么一点点&#x2026;不过鬼才想管这种事情)
</p>

<p>
(不过似乎好多国家都习惯从 0 开始数？比如英式英语把 1 楼叫 the ground floor，2 楼才叫 the first floor)
</p>

<p>
(不过一切都从 0 开始数，很多东西真的会简单好多。比如说算公元前某年到现在的时间，或者数楼层，考试的时候少了好多坑诶)
</p>

<p>
所以就先记着吧，至于从 0 开始数是不是真的简单，我也不太肯定，但大家都是这么说的。养成从 0 开始数的习惯就好了。</p>

<p>
我估计你已经忘记做上面那道题了，现在可以安心写 <code>list-ref</code> 函数了。我啰嗦的习惯要改一改。</p>

<p>
然后是思考题: 如果输入的数字超过了列表的长度会怎么样？你可以自己试一试。是否能用 <code>error</code> 函数返回我们想要的错误呢？</p>

<p>
你可以对比一下官方的 <code>list-ref</code> 函数。把你的函数整体注释掉，然后 Racket 本身已经提供了 <code>list-ref</code> 了，你能在文档上找到。(再提示，直接在左括号前加 <code>#;</code> 可以整体注释掉整个括号的内容，这语法也挺好用的，我希望我不会讲得太快，让你语法记不过来了吧)
</p>

<p>
我保证，是最后一个练习题了。写出函数 <code>all-satisfy?</code>，输入一个函数和一个列表，判断是否所有的元素都满足这个函数。这个函数跟前面的 <code>memf?</code> 是相对应的，因为 <code>memf?</code> 其实也可以叫做
<code>some-satisfy?</code>，就是“是否存在满足函数的元素”。</p>

<p>
有没有感觉到逻辑学的臭味&#x2026;
</p>

<p>
好了，如果说这一节是如何推倒多米诺骨牌，下一节就是，如何小心翼翼地把它们搭起来。</p>
</div>
</div>

<div id="outline-container-org1cc5e47" class="outline-2">
<h2 id="org1cc5e47">┗&gt;&gt; 即可召唤魔法⏎</h2>
</div>
</div>
</body>
</html>