<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-02-10 Mon 14:33 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PL教程 第一章 人和机器</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" type="text/css" href="css/worg.css"/>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">PL教程 第一章 人和机器</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orge7ae1e3">我们的机器</a></li>
<li><a href="#orge86655e">数字们</a></li>
<li><a href="#orge2aa5a4">圈养</a></li>
<li><a href="#org9a25a74">箱子</a></li>
<li><a href="#org8401cc6">降维打击</a></li>
<li><a href="#intro-add-what">习题: 找规律</a></li>
<li><a href="#play-with-racket">在 Racket 中玩耍</a></li>
<li><a href="#org0a3c59f">习题</a></li>
</ul>
</div>
</div>


<div id="outline-container-orge7ae1e3" class="outline-2">
<h2 id="orge7ae1e3">我们的机器</h2>
<div class="outline-text-2" id="text-orge7ae1e3">
<p>
首先我得说，本来这些杂七杂八要放在前言里讲的，结果是&#x2026;
想说的话实在太多，前言已经尽可能地收敛了，还是不知不觉扯远了，前言越到后面写的越跟编程没关系了。所以现在简单说说吧。</p>

<p>
又要提 Dijkstra 的名言了(我怕不是要变成 Dijkstra 的粉丝了&#x2026;)
</p>
<blockquote>
<p>
教一群被 BASIC 语言先入为主的学生，什么是好的编程风格，简直是一件不可能的事。对于一些有潜力的程序员，他们受到的智力伤害远远超过了重建他们的信心。</p>
</blockquote>
<p>
(哈哈，我们学校教的就是 Basic)
</p>

<p>
语言就是人表达的方式，语言塑造了信息的世界。</p>

<p>
受应试教育的影响，很多人接触编程就是从算法竞赛开始的，然后被老师灌输过他们的理论以后，理所当然地认为编程就是算法、数学。当然，很多人跟不上进度便不学了，跟我一样，这是好事。</p>

<p>
我现在也不知道这些误解到底是从哪来的，但我发现编程跟写作真的很像，算法就是那些写作手法，数学可以比作一些特定的知识，比如历史。你可以教小学生再多的手法和各种知识，但不要指望有人能写出好的故事。</p>

<p>
原因在于，写作唯一的目的是表达自己的想法，编程就是为了解决问题。要写一篇好文章，一些手法必不可少，但是重要的东西还有很多，学习手法也要建立在文章写的清楚的基础上。另外，如果要写三国演义，那必须精通历史，但也有很多时候用不着那么高深的历史。<br />
编程就是一样的道理。</p>

<p>
所以我想按程序语言理论(PLT，Programming Language Theory)专业的逻辑讲，它就是对语言本身的研究，能告诉你一个程序语言的本质是什么东西。当然了，研究得很深以后，对实际生活来说也许没什么必要，大多数人也不感兴趣。我只是想把最简单的东西讲一讲，(因为稍微难一点的东西我不会:p)，普及一些正经的课程或书不会提到的东西，讲一些刚学的时候很难理解，但理解以后会感觉“编程怎么这么简单”的知识。顺便一提，我希望最后能让读者学会所有程序语言
(不是要你们去学，而是看到一门新语言，马上就能分析出它的优缺点，类似这样的意思)
能学会各类语言的设计，或者说设计自己的语言。</p>

<p>
现在的语言都有各种乱七八糟的东西，我想尽量讲的简单，让人不要丧失太多的信心。这就是这系列文章的目标。我还不知道我能不能做到。</p>

<p>
给个例子吧，排序，大家都知道，但我一看见那两重循环就头疼，直到我学了 Scheme 语言:
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: #93a8c6;">(</span><span style="color: black;">sort</span> ls<span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">if</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">null?</span> ls<span style="color: #b0b1a3;">)</span> <span style="color: #262680;">null</span>
      <span style="color: #b0b1a3;">(</span><span style="color: #262680;">let</span> <span style="color: #97b098;">(</span><span style="color: #aebed8;">[</span><span style="color: black;">m</span> <span style="color: #b0b0b3;">(</span><span style="color: #262680;">apply</span> <span style="color: #262680;">min</span> ls<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">]</span><span style="color: #97b098;">)</span>
        <span style="color: #97b098;">(</span><span style="color: #262680;">cons</span> m <span style="color: #aebed8;">(</span><span style="color: #262680;">sort</span> <span style="color: #b0b0b3;">(</span><span style="color: #262680;">remq</span> m ls<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
学过的人肯定会有意见，但我不是想显示一下有多简单嘛，第一行定义这个函数名叫 <code>sort</code>。第二行说，如果参数是空列表，结果当然也是空列表。第三行说，否则，就找列表中的最小值。第四行递归进去，就是以同样方式处理剩下的列表。程序写完了。你跟别的语言比一比就知道了。</p>

<p>
(啊对了，感兴趣的可以去跟一个叫 APL 的语言比一比，现在不知道还有多少人听说过这门古老至极的语言，总之在有兴趣的时候，长长见识还是可以的:)
</p>

<p>
那是我第一次发现，写程序这么简单。就在那时我才对编程有了兴趣。以前学算法都只是死学而已。</p>

<p>
我也啃过那本著名的算法导论，说实话，我觉得真正能看下来的不是一般人。为什么呢，那里面的代码&#x2026;实在是太恶心了。我都只能看书上的图画，不看代码，因为书上的代码复杂到没法看。真的。我是那种见到麻烦的东西就泄气的人。比方说吧，我还记得书上红黑树的代码直到最后也没看下去，但是没关系，因为我后来就看到了一本 ML 的教材，它也讲到了红黑树，我一下子就明白了，ML 模式匹配和递归，跟伪 Pascal 代码简直不是一个等级的。</p>

<p>
人使用的语言和接触的环境是会改变人的思考方式的。</p>

<p>
追求简单就是我这些文章的目标。</p>
<blockquote>
<p>
长期以来，有个事一直在困扰我，那就是越昂贵的，越是前沿的，就越可能是没用的。然后，困扰我的另一个事是，电脑是一个死的机器，却可以不可思议地完成那些巧妙的事情，而程序员是那么聪明的人，却在做着不可思议的愚蠢的事情。简而言之，他们真是天生的一对。<br />
—— Bill Bryson
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orge86655e" class="outline-2">
<h2 id="orge86655e">数字们</h2>
<div class="outline-text-2" id="text-orge86655e">
<p>
<b>(注：我感觉我前两节写得很烂，没什么创意，有谁有建议欢迎告诉我)</b>
</p>

<p>
(因为大家都对数学比较熟悉，所以先从数字开始吧，记忆的内容会少很多。当然只要你知道加减乘除就可以了。有趣的东西在后面。)
</p>

<p>
首先，一个程序是什么？</p>

<p>
举个例子吧，这是个什么也不干的程序，名叫 <code>Program</code>:
</p>


<div class="figure">
<p><img src="./img/plt1/prog-id.png" alt="prog-id.png" />
</p>
</div>

<p>
你给它一个数字，它再还给你。我们的电脑可以储存整数和大概十几位的小数。</p>

<p>
在初学阶段不会遇到电脑存不下的数字的，请放心。</p>


<div class="figure">
<p><img src="./img/plt1/simple-calc.png" alt="simple-calc.png" />
</p>
</div>

<p>
可以看出来，写着加减乘除的方框是一个神秘的机器，它吃进去两个数字，把结果吐出来。</p>

<p>
(我们习惯用这4个符号表示加减乘除，因为它们能在键盘上直接打出来)
</p>

<p>
这其实就是四个简单的程序，它们都是你的电脑自带的，我们不用在乎它们对数字干了什么，反正得到了想要的结果，应该相信它们。</p>

<p>
编程的过程就是把它们组合起来的过程。</p>

<p>
你现在拿出纸(画图软件也行)，照着画一下
<code>1+2*3</code>，<code>(1+2)*(3+4)</code>，<code>1+2+3+4</code>
</p>

<p>
(谁也不能阻止你直接往下看，但题目不是我随便写的，请不要看得太快，我认为总会有人遇到问题的)
</p>


<div class="figure">
<p><img src="./img/plt1/compound-calc.png" alt="compound-calc.png" />
</p>
</div>

<p>
首先，需要留意的是，它们不是瞬间发生的，这是编程和数学最大的不同。数学只要式子和结果，不在乎它们的先后过程，所以数学可以解方程。但作为一个现实的程序，它永远有计算的顺序，我们不但关注它的结果，我们还关注它是怎么计算出来的。</p>

<p>
计算 <code>1+2*3</code>，首先是 2 和 3 进入乘法程序里，等 6 出来之后，它和 1 一起进入加法程序。</p>

<p>
第二个问题是，<code>(1+2)*(3+4)</code> 中，两个加法能否同时运行。你可以认为，它们是不能同时运行的，电脑里只有一个加法程序，它算完 <code>1+2</code> 之后，跑到下面去算 <code>3+4</code>，然后 3 和 7 一起进入乘法程序。当然，也可以先算 <code>3+4</code>，反正得一个一个算。</p>

<p>
(现在的电脑多数都能自动同时计算这两个式子。(知道多核 CPU 的人别着急，这是单个 CPU 内的并行，跟你知道的东西无关)
但是这对你来说不重要。电脑爱怎么算它跟你无关，就算同时计算也只是把速度乘了个倍数而已，对我们来说，在乎这些东西没有意义。)
</p>

<p>
第三个图就有些微妙，有人可能有不一样的结果，可能是 <code>(1+2)+(3+4)</code>
而不是 <code>((1+2)+3)+4</code>. 它们有什么区别自己思考。</p>

<p>
再加一个思考题: 我们有没有漏某种情况？</p>

<p>
虽然很烦人，但程序的问题就是这么出现的，考虑边边角角是个好习惯。至少需要知道，一个数除以 0 会怎么样。按照常识，程序会出错，就是这样。不多说了。</p>
</div>
</div>

<div id="outline-container-orge2aa5a4" class="outline-2">
<h2 id="orge2aa5a4">圈养</h2>
<div class="outline-text-2" id="text-orge2aa5a4">
<blockquote>
<p>
管理一群程序员就像放养一群猫<br />
—— 无名氏
</p>
</blockquote>
<p>
所以管理一群数字&#x2026;(瞎扯)
</p>

<p>
比方说，要计算复杂的公式，或者有重复的式子，比如 <code>1+2</code> 的平方:
</p>


<div class="figure">
<p><img src="./img/plt1/complex-sqr-1+2.png" alt="complex-sqr-1+2.png" />
</p>
</div>

<p>
画两遍 <code>1+2</code> 就有些麻烦(好吧我是复制粘贴&#x2026;)，还费时间费电，变量就出现了。<br />
先定义个变量 <code>three</code>，然后让它平方。</p>


<div class="figure">
<p><img src="./img/plt1/sqr-three.png" alt="sqr-three.png" />
</p>
</div>

<p>
你可能看不出来为什么要一个变量？完全可以在图里把 <code>three</code> 去掉，直接从左到右画两条箭头。那个 <code>three</code> 本质上什么都不是，只是给那两个箭头起了个名字罢了。变量在本质上就是给箭头起个名字，这样也许可以减少重复计算，不过多数时候也是为了让人更容易看懂。我为了把这个名字和程序区分开，用一个圆圈表示，但其实它什么都没干，只是传递了一个数据。</p>

<p>
在实际程序中，即使没有重复的计算，也应该适当使用变量，并给它取个好名字，这样程序就更容易读懂了。变量的名字对电脑来说无所谓，只要不重复就行，只是对人来说就不一样了。</p>

<p>
当然，一个变量只能储存一个数字。关于变量其实就这么多。</p>
</div>
</div>

<div id="outline-container-org9a25a74" class="outline-2">
<h2 id="org9a25a74">箱子</h2>
<div class="outline-text-2" id="text-org9a25a74">
<p>
数学老师讲过什么叫函数。也许是这么说的:<br />
<code>y=x+1</code><br />
这就是个函数。</p>

<p>
可是在程序里就有点问题了，如果是这样:
</p>


<div class="figure">
<p><img src="./img/plt1/wrong-function.png" alt="wrong-function.png" />
</p>
</div>

<p>
那 <code>y</code> 只是个变量而已，比如这个程序的前面定义过 <code>x</code> 是 100，那么 <code>y</code> 就是 101，是一个固定的数字，如果 <code>x</code> 没有定义过，那程序就出错。</p>

<p>
那什么是函数呢，你可以想象成一个机器，有入口，有出口，在内部对数字进行一些加工。简单来说，把 <code>x+1</code> 打个包就是个函数了。</p>


<div class="figure">
<p><img src="./img/plt1/func-y=x+1.png" alt="func-y=x+1.png" />
</p>
</div>

<p>
它左右的两根线就是入口和出口，这个 <code>x</code> 被包在了函数里面，然后被传给了一个加法程序，(1就是凭空出现的)，然后把结果传出去。在编程里，函数的输出一般被叫做“返回值(return value)”，或者干脆说函数的“值(value)”。</p>

<p>
我这里只是把它画成了透明的，实际中是看不到函数内部的，所以我们给它贴了个名字叫 <code>add1</code>，告诉我们这个函数的作用。(叫它 y 或者 f 都可以，但因为这些名字没有意义，所以不推荐)
</p>

<p>
思考: 仔细对比之前学过的几幅图，你可能会发现什么。</p>

<p>
第一个发现: 函数就是个小的程序，程序就是个函数。它们长得是一样的。这告诉我们，一个程序的本质不是一行行代码，计算的本质也不是按照代码一行一行算下来。一个程序只不过是得到一些输入，按你的要求计算一些东西，然后输出而已。(其实很早以前，函数(function)就被叫做子程序(sub-routine))
</p>

<p>
第二个发现: 函数长得跟加减乘除一模一样。也就是说，加减乘除其实就是函数! 你看，它们的概念也是一样的，输入、加工、输出。编程中函数的定义更广了，函数可以有任意数量的输入，而不只是一个。</p>

<p>
从这里我们就大概能体会到函数存在的意义了，在电脑中，甚至一个加法都是很复杂的，你知道的，通过各种二进制的电路来实现，但是你学编程，不需要知道电路是怎么样的，只要使用加法函数就可以，那个加法函数的内部，其实是极其复杂的运算。</p>

<p>
这就是函数的意义，它让你不用每次做加法都把复杂的二进制计算写一遍，而是一个加法函数搞定。你自己写的函数也是一样。</p>

<p>
举个例子，<code>sqr</code> 函数是平方函数: sqr(x)=x<sup>2</sup>
</p>


<div class="figure">
<p><img src="./img/plt1/func-sqr.png" alt="func-sqr.png" />
</p>
</div>

<p>
这 3 个函数的作者分别是正常人，一个疯狂的黑客，还有一个存心坑你的人，除了速度快慢，你并不能感觉出什么差异，反正你用的开心就可以。在写大一些程序的时候，这个作用就体现出来了。</p>

<p>
我啰嗦这么多，看起来很简单，可是确实这点容易被忽视。刚开始学的时候，我们都没有把一块程序提取出来成为一个函数的意识，我看过的很多代码，比如要算 x<sup>2</sup> 并采用了第二种很复杂的做法
(比方说是为了提高一点点效率)，却不把它写成函数，看过去就是一大堆“&#x2026;&#x2026; x &#x2026;&#x2026;” 
我要费很大功夫才能看懂他要干嘛。就因为这个，很多教科书建议大家写注释，就是在旁边注一句“这段代码把x平方”。可是只要写成函数，函数的名字就充当注释的作用了，这些麻烦就都没了。这也是函数的用处之一。把小的函数组合起来，最终能够形成一个大型程序，如果一开始就想着整个大型程序的代码，到最后肯定是脑子一团糟的。</p>

<blockquote>
<p>
需要注意的是，没有哪个好工程师会赞成写一个“摧毁巴克达”的函数。最基本的职业规范告诉他们，应该去写一个叫“摧毁城市”的函数，然后把“巴克达”当成这个函数的参数。<br />
—— Nathaniel S. Borenstein
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org8401cc6" class="outline-2">
<h2 id="org8401cc6">降维打击</h2>
<div class="outline-text-2" id="text-org8401cc6">
<p>
到现在我只画了图，因为那个图才是程序的含义，现在确实有这样画画图就可以编程的语言，但我都不满意，什么时候我有能力了可以考虑编一个这样的语言。但现在还是只能学要一行一行打代码的语言了。画图多形象啊，为什么大家都喜欢写代码呢。</p>

<p>
(此括号内为扯淡时间，之后遇到这个情况可以返回来看一看，现在还是跳过吧~
</p>

<p>
当然，肯定还有人想问，为什么我非要用英文不可呢，中文难道不能编程吗。当然可以，你如果记不住英文，你就直接用中文字打变量名，没人会怪你。而且，如果记不住语言自带的函数名，你可以直接给它起别名，举个例子，(我经常这么干，当然对于 <code>+</code> 这种早就记住的就不用了)
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">&#21152;</span> <span style="color: #262680;">+</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
甚至，你要是觉得几个特殊语法也记不住，你可以复制如下代码去试一下
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define-syntax-rule</span> <span style="color: #93a8c6;">(</span><span style="color: black;">&#23450;&#20041;</span> x <span style="color: #262680;">...</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">define</span> <span style="color: black;">x</span> <span style="color: #262680;">...</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define-syntax-rule</span> <span style="color: #93a8c6;">(</span><span style="color: black;">&#20989;&#25968;</span> x <span style="color: #262680;">...</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> x <span style="color: #262680;">...</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define-syntax-rule</span> <span style="color: #93a8c6;">(</span><span style="color: black;">&#22914;&#26524;</span> x <span style="color: #262680;">...</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">if</span> x <span style="color: #262680;">...</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">tests</span>
<span style="color: #8c8c8c;">(</span>&#23450;&#20041; &#21152; <span style="color: #262680;">+</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span>&#23450;&#20041; &#22777; <span style="color: #228b22;">1</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span>&#23450;&#20041; &#21152;&#19968; <span style="color: #93a8c6;">(</span>&#20989;&#25968; <span style="color: #b0b1a3;">(</span>&#21442;&#25968;<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span>&#21152; &#21442;&#25968; &#22777;<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>&#21152;&#19968; &#22777;<span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">2</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#27492;&#22788;&#24212;&#26377;&#34920;&#24773;&#21253;</span>
</pre>
</div>
<p>
应该能看懂了吧
</p>

<p>
:)
</p>

<p>
我费了好大的劲挑出来了这个语言，叫 <a href="https://www.racket-lang.org">Racket</a>，虽然还是不太满意，但毕竟没有什么明显的缺点，只要不被它的括号吓跑的话&#x2026;
</p>

<p>
输入一个数字，Racket 就会原样输出。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #228b22;">2333</span>
<span style="color: #228b22;">2333</span>
<span style="color: #262680;">&gt;</span> <span style="color: #228b22;">-123.456</span>
<span style="color: #228b22;">-123.456</span>
</pre>
</div>
<p>
一般来讲，在电脑上看到这个大于号“&gt;”，后面就是我们要输入的东西，输入之后按回车，电脑就会在下一行把结果显示出来。我为了程序看的清楚，如果一行写不下可以换行。</p>

<p>
这是加减乘除，你可以试着在键盘上把这4个符号找出来。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">3</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">-</span> <span style="color: #228b22;">3</span> <span style="color: #228b22;">2</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">6</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">/</span> <span style="color: #228b22;">10</span> <span style="color: #228b22;">2</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">5</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">7</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span><span style="color: #93a8c6;">)</span>
     <span style="color: #93a8c6;">(</span><span style="color: #262680;">-</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">/</span> <span style="color: #228b22;">4</span> <span style="color: #228b22;">2</span><span style="color: #b0b1a3;">)</span> <span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">3</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">+</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span><span style="color: #b0b1a3;">)</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span> <span style="color: #228b22;">4</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">10</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span> <span style="color: #228b22;">4</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">10</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span> <span style="color: #228b22;">4</span> <span style="color: #228b22;">5</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">120</span>
</pre>
</div>
<p>
首先，加减乘除的格式是统一的，一对括号，括号中第一个是函数名，后面跟参数，用空格隔开。所以 <code>(+ 1 2)</code> 就是数学中的 <code>(1+2)</code><br />
函数可以嵌套，比如
</p>


<div class="figure">
<p><img src="./img/plt1/complex-arith.png" alt="complex-arith.png" />
</p>
</div>

<p>
放心，以后不会有这么复杂的式子的。<br />
(话说回来，也许代码比画图有个好处，因为代码稍微复杂点就看不清楚，所以它逼着人们写简单的代码。)
</p>

<p>
数学中的函数是有优先级的，但 Racket 里没有，而且也不能省略括号或乘号，也不能多加括号。比如我多加了个括号 <code>(1)</code>，但其中的1的位置应该是一个函数
(比如加减乘除)，但1不是函数，所以会出错。总之，就是完全的死板就对了。</p>

<p>
刚开始学编程的时候我也很烦这个，因为打字麻烦死了
(不过相信我，你除非在编一道数学问题，不然一般是不会遇到这样复杂的数学公式的)。但现在我居然也开始慢慢欣赏这种死板的写法了，在我看过很多一大串的、根本搞不懂哪个符号是哪个的数学公式之后。相信我。</p>

<p>
最后是 Racket 提供的一个便利的写法，因为连续相加和相乘很常用，所以加法和乘法可以有任意个参数。</p>

<p>
这就是所有的数学内容。</p>

<hr />

<p>
定义变量:
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">abc</span> <span style="color: #228b22;">123</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">this-is-a-variable</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">+</span> abc <span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> abc
<span style="color: #228b22;">123</span>
<span style="color: #262680;">&gt;</span> this-is-a-variable
<span style="color: #228b22;">124</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">abc</span> <span style="color: #228b22;">100</span><span style="color: #8c8c8c;">)</span>
&#20986;&#38169;&#65292;&#22240;&#20026;&#21464;&#37327;&#19981;&#33021;&#37325;&#22797;&#23450;&#20041;
</pre>
</div>
<p>
定义变量的语法是 <code>define</code>，跟着要定义的变量的名字和它的值。</p>

<p>
一个变量名可以是字母或大多数的符号(<code>+-*/&lt;&gt;?=!%^</code> 之类)或数字连在一起，一般会用英文单词，习惯上中间用横杠(就是减号)隔开，让人看得更清楚。一个变量名字的左右都要有空格(或换行)隔开，所以这时的横杠并不会被当成减法函数。</p>

<p>
思考: <code>define</code> 是函数吗？</p>

<p>
那要先看看函数是什么。</p>

<p>
一个函数，在调用之前应该先计算它的参数，比如 <code>(+ (* 1 2) abc)</code>
(假设 <code>abc</code> 还是上面定义过的 123)，程序先计算 <code>(* 1 2)</code> 结果是2，<code>abc</code> 结果是 123，然后再运行 <code>(+ 2 123)</code>
</p>

<p>
如果 <code>define</code> 是函数，那么比如 <code>(define x ...)</code> 需要先计算
<code>x</code> 的结果，但这时候 <code>x</code> 还没有定义。显然是不对的。</p>

<p>
<code>define</code> 只是一个特殊的语法。它只是定义变量这个动作，所以它也没有输出，只能单独写作一行。只是格式跟函数长得一样而已。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">m</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">define</span> <span style="color: black;">n</span> <span style="color: #228b22;">100</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
&#20986;&#38169;&#65292;&#22240;&#20026; <span style="color: #262680;">define</span> &#21482;&#26159;&#20010;&#21160;&#20316;&#65292;&#27809;&#26377;&#36755;&#20986;
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">define</span> <span style="color: black;">x</span> <span style="color: #228b22;">100</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
&#20986;&#38169;&#65292;&#21516;&#29702;
</pre>
</div>

<hr />

<p>
下面就是自定义函数了。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #93a8c6;">(</span>x<span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">+</span> x <span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
#&lt;procedure&gt;
</pre>
</div>
<p>
<code>λ</code> 开头的式子是一个函数，接下来是一个括号，括号里是参数的名字，再接下来是函数输出的值。很明显，<code>λ</code> 也是个特殊语法。</p>

<p>
(不会直接打出 <code>λ</code> 的话，可以用 <code>lambda</code> 代替，你在其它地方看到的程序，一般也都会用 <code>lambda</code>，之后就不提这个了)
</p>

<p>
顺便一提，它会输出 <code>#&lt;procedure&gt;</code> 而不是原模原样的
<code>(λ (x) (+ x 1))</code>，就是因为这个函数内部已经看不见了。因此所有的函数在我们看来，都是一样的 <code>#&lt;procedure&gt;</code>
</p>

<p>
函数也可以有任意个参数，比如
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #93a8c6;">()</span> <span style="color: #228b22;">1</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">always 1</span>
#&lt;procedure&gt;
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #93a8c6;">(</span>x<span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">*</span> x x<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">square (&#24179;&#26041;)</span>
#&lt;procedure&gt;
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">pi</span> radius<span style="color: #93a8c6;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">area of circle (&#22278;&#38754;&#31215;)</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">*</span> <span style="color: #262680;">pi</span> radius radius<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
#&lt;procedure&gt;
</pre>
</div>
<p>
跟在分号后面，颜色不一样的，是程序的注释，会被计算机忽略，它们就是专门写给人看的，之后我会用注释来简单解释程序的意思。</p>

<p>
上面只是写了几个函数，但就像只写个数字一样，你得把它定义给变量，不然它并没有被定义，输出以后就消失了。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">always1</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">()</span> <span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">sqr</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> x x<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">circle-area</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">pi</span> radius<span style="color: #b0b1a3;">)</span>
      <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> <span style="color: #262680;">pi</span> radius radius<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#25110;&#32773; (* pi (sqr radius))</span>
</pre>
</div>
<p>
现在我们定义了3个新的变量。</p>

<p>
你可能又发现了，定义函数的语法跟定义数字变量是一样的，只是后面跟数字还是函数的区别。现在，变量的含义增加了。变量可以储存一个数字或者一个函数。</p>

<p>
调用函数也是一样的，括号中第一个是函数，后面跟它们的参数，你会发现它们和加减乘除的格式是统一的。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>always1<span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1</span>
<span style="color: #262680;">&gt;</span> always1 <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#27880;&#24847;&#36319;&#19978;&#19968;&#20010;&#30340;&#21306;&#21035;</span>
#&lt;procedure:always1&gt;
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">sqr</span> <span style="color: #228b22;">3</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">9</span>
<span style="color: #262680;">&gt;</span> <span style="color: #262680;">sqr</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#25968;&#23398;&#19978;&#24635;&#26159;&#29992; (sqr x) &#34920;&#31034;&#36825;&#20010;&#20989;&#25968;&#65292;</span>
      <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#20320;&#20250;&#21457;&#29616;&#26159;&#22810;&#20040;&#38169;&#35823;&#30340;&#19968;&#20010;&#20889;&#27861;&#65292;</span>
      <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#35831;&#33258;&#24049;&#22909;&#22909;&#24605;&#32771;&#19968;&#19979;&#36825;&#20010;&#38382;&#39064;</span>
#&lt;procedure:sqr&gt;
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>circle-area <span style="color: #228b22;">3.14</span> <span style="color: #228b22;">10</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">314</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#31561;&#20215;&#20110;&#30452;&#25509;&#29992; &#955; &#26367;&#25442;</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">pi</span> radius<span style="color: #b0b1a3;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#26368;&#22806;&#38754;&#30340;&#25324;&#21495;&#26159;&#20989;&#25968;&#35843;&#29992;</span>
     <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> <span style="color: #262680;">pi</span> radius radius<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
   <span style="color: #228b22;">3.14</span> <span style="color: #228b22;">10</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">314</span>
</pre>
</div>
<p>
就跟数字可以直接写出来，不一定要定义给变量一样，函数也可以直接写出来用，只是看起来比较复杂。</p>

<p>
我们定义和使用一个函数其实是这样的，它们在计算机中都只有一个，但是存进变量以后，什么时候使用它，变量就把它拿出来，跟拿出一个数字一样。</p>


<div class="figure">
<p><img src="./img/plt1/define-use-func-sqr.png" alt="define-use-func-sqr.png" />
</p>
</div>

<p>
因为这么画太不方便，所以才画成函数上面贴个名字。</p>

<p>
课外知识:<br />
有人可能会好奇函数是怎么存进变量里的，答案就是，变量存的其实还是个数字。<br />
比如地球上任意的位置都可以用数字(经纬度)表示，用 GPS 可以定位，电脑里也是这样。函数也是一段程序，它也是储存在电脑里的，所以它在电脑里有一个地址，这个地址就像经纬度一样，是个数字。我们要调用这个函数，只要知道它的地址，就可以找到这段程序，然后运行，就是这么简单。<br />
现在不用在意这些细节问题，等到接触操作系统及以下的底层知识的时候，会很详细地讲这些东西(说实在底层的知识挺无聊的，还是高级一点的语言有意思)
</p>

<hr />

<p>
最后的问题就是，函数参数的名字。</p>

<p>
比方说我还是跟计算圆的周长和面积，我把函数再重新列出来。</p>

<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">pi</span> <span style="color: #228b22;">3.1415926</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">circle-area</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#22278;&#30340;&#38754;&#31215;</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">pi</span> radius<span style="color: #b0b1a3;">)</span>
      <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> <span style="color: #262680;">pi</span> radius radius<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">circle-circumference</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#22278;&#30340;&#21608;&#38271;</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">pi</span> radius<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">2</span> <span style="color: #262680;">pi</span> radius<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
这里出现了3处 <code>pi</code>，但大家都知道这3个 <code>pi</code> 没有任何关联，<code>circle-area</code> 和 <code>circle-circumference</code> 的参数不会暴露在外面，所以即使调用 <code>circle-area</code> 和 <code>circle-circumference</code>
也不会导致 <code>pi</code> 被重新定义。</p>


<div class="figure">
<p><img src="./img/plt1/name-conflict.png" alt="name-conflict.png" />
</p>
</div>

<p>
函数 <code>circle-area</code> 和 <code>circle-circumference</code>
中定义的 <code>pi</code> 都在函数内部，电脑遵循就近原则，函数内有 <code>pi</code> 了，就不去函数外找了。如果没有，再找函数外的，比如
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">circle-area-v2</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">another version</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>radius<span style="color: #b0b1a3;">)</span>
      <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> <span style="color: #262680;">pi</span> radius radius<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>circle-area-v2 <span style="color: #228b22;">10</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">314.15926</span>
</pre>
</div>

<div class="figure">
<p><img src="./img/plt1/outer-env.png" alt="outer-env.png" />
</p>
</div>

<p>
程序并没有出错，因为我们已经在外层定义过 <code>pi</code> 了。这个函数发现它要使用 <code>pi</code>，但它的参数没有 <code>pi</code>，于是它就到外面去找，发现 <code>pi</code> 是 <code>3.1415926</code>，于是使用了这个值。</p>

<p>
如果函数外也没定义 <code>pi</code>，那就只能出错了。</p>

<p>
可以想一下这样做的好处。很多时候，程序里有很多很多变量，比如各种常数和各种函数，大一点的程序是很多人一起写的，每个人都不知道别人到底定义了什么，要阻止重名是不可能的事了。</p>

<p>
很容易想到的就是，我使用一个变量(包括调用一个函数)，如果我定义过了，那就先用我的，不用管别人定义了什么。问题就解决了。</p>

<p>
思考: 上面的做法有 bug，不知道你能不能看出来<br />
注: 这是一道超级难题。去看看历史就知道它花了科学家多长时间。直到现在还有些语言有这个问题。比如我现在正在 <code>emacs</code> 上写这篇博客，它用的语言 <code>emacs-lisp</code> 就是这样的<br />
提示: 调用 <code>circle-area-v2</code> 函数。</p>

<p>
看看这个函数吧。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">(define pi 3.1415926)</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">(define circle-area-v2</span>
<span style="color: #ff7f24;">;;   </span><span style="color: #ff7f24;">(&#955; (radius)</span>
<span style="color: #ff7f24;">;;     </span><span style="color: #ff7f24;">(* pi radius radius)))</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">cylinder-volume</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#22278;&#26609;&#20307;&#31215; = &#24213;&#38754;&#31215; &#215; &#39640;</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">pi</span> radius height<span style="color: #b0b1a3;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#36825;&#20010; pi &#20250;&#35206;&#30422;&#22806;&#30028;&#30340; pi</span>
      <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> <span style="color: #97b098;">(</span>circle-area-v2 radius<span style="color: #97b098;">)</span> height<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>cylinder-volume <span style="color: #228b22;">3.14</span> <span style="color: #228b22;">1</span> <span style="color: #228b22;">1</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">3.1415926</span> ? <span style="color: #228b22;">3.14</span> ?
</pre>
</div>
<p>
现在的问题来了，<code>circle-area-v2</code> 中的 <code>pi</code> 到底是哪个 <code>pi</code>，是最外层的常数，还是 <code>cylinder-volume</code> 的参数？</p>

<p>
(你最好拿张纸把这几个函数抄一下，在纸上打打草稿，不然光看要晕倒的)
</p>

<p>
先讲现在已经抛弃了的方法。</p>

<p>
照我们前面的解释，调用 <code>(cylinder-volume 3.14 1 1)</code> 之后，离 <code>circle-area-v2</code> 更近的 <code>pi</code> 变成了 <code>3.14</code>，而不是外界的 <code>3.1415926</code>，所以结果是 <code>3.14</code>。</p>

<p>
或者，因为 <code>circle-area-v2</code> 是 <code>(λ (radius) (* pi radius radius))</code>，所以把 <code>circle-area-v2</code> 用它的值代换，<code>cylinder-volume</code> 就等价于
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">pi</span> radius height<span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">*</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> <span style="color: #262680;">pi</span> radius radius<span style="color: #b0b1a3;">)</span>
     height<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
所以答案就还是神奇地变成了 <code>3.14</code>。</p>

<p>
所以许多最古老的语言就都是这么做的，因为看起来理所当然。</p>

<p>
但理所当然是不行的，对一个语言来说，实用才是关键。所以还要看看它靠不靠谱。比如 <code>circle-area-v2</code>
是我写的，我为了方便，定义了个变量 <code>pi</code>，然后在 <code>circle-area-v2</code> 里用了 <code>pi</code>，然后把代码发给了你，你上来就写了个 <code>cylinder-volume</code>，你看了看，<code>circle-area-v2</code> 只有一个参数 <code>radius</code>，也就是说圆的面积只跟输入的半径有关。所以我如果一直输入半径为 <code>1</code>，结果也应该永远是个定值 <code>(circle-area-v2 1)</code>，即 3.1415926。结果发现 <code>(cylinder-volume 3.1415926 1 1)</code> 是 3.1415926，<code>(cylinder-volume 3.14 1 1)</code> 是 3.14，很不对是吧。都是 <code>(circle-area-v2 1)</code>，结果居然不一样。这还怎么写代码。</p>

<p>
那我也很不爽啊，我好好地定义了个 <code>pi</code>，结果被你的给覆盖了。</p>

<p>
(可能有人觉得，没人会在 <code>cylinder-volume</code> 里定义 <code>pi</code> 却不用，那我大不了就用一下呗，比如我要一个高就为 <code>pi</code> 的圆柱。<br />
非常实际的例子暂时举不出，但真的太多太多了，但我暂时真的想不出来这种难度的例子了/(ㄒoㄒ)/~~)
</p>

<p>
总归事实已经证明了，这对一门语言带来的几乎都是灾难。</p>

<p>
于是有人提出来，我们说“最近的变量”，不应该是在使用的时候最近，而是在定义的时候最近。<code>circle-area-v2</code> 在定义时，<code>pi</code> 就是 3.1415926，这才应该是离它最近的那个 <code>pi</code>，那它就应该保存那个 <code>pi</code>，它的 <code>pi</code> 就应该一直是 3.1415926，而不会随着使用时外界的 <code>pi</code> 而变化。</p>

<p>
现在一个函数不只包含一段程序了，它还要包含它定义的时候，所有用到的变量存放在哪里(地址)。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">...</span><span style="color: #93a8c6;">)</span> <span style="color: #262680;">...</span><span style="color: #8c8c8c;">)</span>
#&lt;procedure&gt;
</pre>
</div>
<p>
现在能理解为什么函数只会显示个 <code>#&lt;procedure&gt;</code> 了吧。</p>

<p>
函数里包含了一堆东西，没法把它显示出来，只能用个 procedure 糊弄你一下。但这确实就是函数的全部了。</p>


<div class="figure">
<p><img src="./img/plt1/scoping-explain.png" alt="scoping-explain.png" />
</p>
</div>

<p>
现在再看看我们画的图(伟大的美术作品&#x2026;)，就不会出现这种问题。很清楚，我们画下这个函数的时候，就已经确定了所有变量的来源。实际上在图中，完全可以把变量的名字去掉，只画没有名字的圆圈就行，因为使用变量不需要通过名字，只需要知道它在哪就可以(前面所说的地址)，这就向机器语言又进了一步。</p>

<p>
对于想知道术语，去网上查资料的人:
现在的做法叫静态作用域(static scoping)或词法作用域(lexical scoping)，过去的做法叫动态作用域(dynamic scoping)。因为过去变量是在函数调用的时候找的，是“动态”查找的。现在定义时候变量就确定了，是“静态”的。</p>
</div>
</div>

<div id="outline-container-orgf7dd030" class="outline-2">
<h2 id="intro-add-what"><a id="orgf7dd030"></a>习题: 找规律</h2>
<div class="outline-text-2" id="text-intro-add-what">
<p>
这节是前面的一个复习。写几个简单的函数。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">add-chip</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #97b098;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">10</span> x<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">test</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>add-chip <span style="color: #228b22;">666</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">6661</span>
</pre>
</div>
<p>
这个函数把一个数字的末尾加一个1。因为1就像一根薯条一样，所以起名为
<code>add-chip</code> (我要装作一本正经的样子)
</p>

<p>
同理，你可以想到我要干什么事
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">add-pie</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">0</span> <span style="color: #97b098;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">10</span> x<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">add-peanut</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">8</span> <span style="color: #97b098;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">10</span> x<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">test</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>add-chip <span style="color: #93a8c6;">(</span>add-pie <span style="color: #b0b1a3;">(</span>add-peanut <span style="color: #228b22;">0</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">801</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#35831;&#33258;&#24049;&#24819;&#35937;&#19968;&#19979;&#20989;&#25968;&#35843;&#29992;&#30340;&#22270;&#20687;</span>
</pre>
</div>
<p>
(这应该是个容易让你变胖的甜点)
</p>

<p>
当然，你也可以写出更多这样的函数，但是写的多了，你可能就发现你在写很多重复的东西，因为这些函数都是
<code>(λ(x) (+ ? (* 10 x)))</code>。注意，复制粘贴不是什么好办法，我们可以写出一个通用的函数来代替它们。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">add-what</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>what x<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">+</span> what <span style="color: #97b098;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">10</span> x<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">test</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>add-what <span style="color: #228b22;">1</span> <span style="color: #228b22;">666</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">6661</span>
</pre>
</div>
<p>
请仔细体会一下这个函数是怎么写出来的，我们把会变的部分写成了一个参数。</p>

<p>
请画一下下面这幅图像，最好把3个函数画在一条水平线上，要求是画得尽量好看。</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>add-what <span style="color: #228b22;">1</span> <span style="color: #93a8c6;">(</span>add-what <span style="color: #228b22;">0</span> <span style="color: #b0b1a3;">(</span>add-what <span style="color: #228b22;">8</span> <span style="color: #228b22;">111</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
______ <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#35831;&#22635;&#31354;&#65292;3&#20010;&#25968;&#23383;&#30340;&#39034;&#24207;&#27880;&#24847;&#19981;&#35201;&#21453;&#20102;</span>
</pre>
</div>
<p>
当然，这个函数是通用了，但是代码变麻烦了，那么也很简单，用这个函数定义之前的3个函数就行了。把之前的定义修改成如下
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">add-chip</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>add-what <span style="color: #228b22;">1</span> x<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">add-pie</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>add-what <span style="color: #228b22;">0</span> x<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">add-peanut</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>add-what <span style="color: #228b22;">8</span> x<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
这些定义看起来会比原来的简单一些。</p>

<p>
请再次体会一遍这个思路。</p>

<p>
首先，我们知道如何在一个数后面加一个数字，这种数学知识是底层的细节，在写代码的时候，最好总是假设别人不会这个细节，比如别人对数学一无所知。嗯&#x2026;
</p>

<p>
所以我们写了一个通用的函数 <code>add-what</code> 来表示这个细节，这样只需要调用它就可以了。然后直接使用它也可以，如果有些参数使用得比较频繁，那就自己再定义几个特殊的函数，<code>add-chip</code>，<code>add-pie</code>，<code>add-peanut</code>。</p>

<p>
其实编程基本上都是在干这种事。从最底层开始，逻辑元件把二极管三极管
什么的物理知识隐藏起来了，集成电路把逻辑知识隐藏起来了，操作系统把硬件隐藏起来了，而我们用的语言又把系统级别的操作隐藏起来了。就这样一层一层，让我们更关注于我们要写的程序，而不是底层的这些东西如何工作。</p>

<p>
这有一个名词，叫做“抽象(abstraction)”。</p>

<p>
这里的抽象不是指让人难理解，相反，它指的是把底层复杂的东西隐藏起来，比如，完全不会数学的人也能调用 <code>add-what</code>，他会发现他的数后面神奇地添加上了另一个数字；完全不懂电路的人也会玩电脑；也有许多不懂物理的 3D 游戏程序员&#x2026;&#x2026;
我们不知道它们内部是什么，但不知道这些对我们没有影响，甚至更方便了。理解抽象是怎么回事也可以算是编程的内功吧。</p>
</div>
</div>

<div id="outline-container-org7296d1d" class="outline-2">
<h2 id="play-with-racket"><a id="org7296d1d"></a>在 Racket 中玩耍</h2>
<div class="outline-text-2" id="text-play-with-racket">
<p>
这章讲如何安装 Racket，懒得搞这些东西的话可以直接跳过。</p>

<p>
我故意跟别的教材不一样，其它的书都先让人安装各种软件，这样就可以在电脑上一边看书一边试验了，这是好事。但是，我发现一直待在电脑前，让我养成了一个很坏的习惯:
当我思路还没理清楚时，就迫不及待地想到哪写到哪，最后把整个程序搞得很糟，只能反复找 bug。相反，如果我手头没有电脑，我就只能在纸上打草稿，草稿就不那么容易随便修改，所以必须让程序在脑子里完全成型了再写下来，最后把它打到电脑里，一次性就是完全正确的。</p>

<p>
电脑本来就只是辅助你运行程序的，如果自己没有完全理清思路，就不要指望电脑能得出正确的结果。</p>

<p>
还要说的是，你用什么样的电脑，什么操作系统，你的打字速度，都是完全没有关系的。一定要用你最熟悉的操作系统，或者你的朋友/同学/同事用啥你就用啥。我看到有些教程一上来就让你装 Linux 和各种开发环境，有人折腾半天还没开始编程，感觉自己连电脑也不会用，还是别想着编程了，这真的是很糟糕的。(但是如果你还在用 Windows XP，我无法保证你能安装，因为 XP 实在太老了，现在几乎装不了什么软件了，建议换个新操作系统吧，我也不知道为什么在中国还有一些人在用这么老的东西。)
</p>

<p>
首先，Racket 官网是这个 <a href="https://www.racket-lang.org">https://www.racket-lang.org</a>，你也可以直接去下载页面 <a href="https://download.racket-lang.org">https://download.racket-lang.org</a>，默认下载就可以。如果你不熟悉，一路默认安装就可以，安装完以后你的桌面上就会出现 DrRacket 的快捷方式了。(像我一样用 Ubuntu 的可以直接通过 apt 安装 <code>sudo apt install racket</code>，DrRacket 会添加在你的应用里面。当然也可以用 Emacs 来编辑 Racket，我一直用的是 racket-mode，自己稍稍配置一下 paredit-mode 什么的，用起来还是挺舒服的。)
</p>

<p>
打开 DrRacket 以后，首先就在文件第一行打上 <code>#lang racket</code>，然后在后面就可以写代码了。具体不会操作的请直接上网搜，“如何安装/使用 DrRacket”
</p>

<p>
然后一定要记得切换到英文输入法，因为中英文的标点符号都是不一样的。</p>

<p>
接下来就可以玩耍了。</p>

<p>
在 <b>定义窗口(definition window)</b> 写一些变量定义，然后点屏幕右上角的 run 或者按 F5，就可以运行定义的内容，然后在 <b>交互窗口(interaction window)</b> 输入一些东西的计算。(具体怎么操作网上有详细教程，我懒得说了)
</p>

<p>
总共就这些要讲的，但如果你觉得不够，我就再说一些杂七杂八的内容。这些就别记了，知不知道都无所谓，就当了解一下了。</p>

<p>
先说一些数字计算
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">/</span> <span style="color: #228b22;">7</span> <span style="color: #228b22;">3</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">7/3</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">/</span> <span style="color: #228b22;">7</span> <span style="color: #228b22;">3.0</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">2.3333333333333335</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">expt</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">100</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">the 100th power of 2</span>
<span style="color: #228b22;">10715086071862673209484250490600018105614048117055336074437503883703510511249361224931983788156958581275946729175531468251871452856923140435984577574698574803934567774824230985421074605062371141877954182153046474983581941267398767559165543946077062914571196477686542167660429831652624386837205668069376</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">sqrt</span> <span style="color: #228b22;">2</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">square root</span>
<span style="color: #228b22;">1.4142135623730951</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cos</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">/</span> <span style="color: #262680;">pi</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">0.5000000000000001</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">exact-&gt;inexact</span> <span style="color: #228b22;">7/3</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">2.3333333333333335</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">inexact-&gt;exact</span> <span style="color: #228b22;">2.3333333333333335</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">5254199565265579/2251799813685248</span>
<span style="color: #262680;">&gt;</span> 1.23e5
<span style="color: #228b22;">123000.0</span>
<span style="color: #262680;">&gt;</span> <span style="color: #228b22;">2e20</span>
<span style="color: #228b22;">2e+20</span>
<span style="color: #262680;">&gt;</span> <span style="color: #228b22;">2e-4</span>
<span style="color: #228b22;">0.0002</span>
</pre>
</div>
<ol class="org-ol">
<li>Racket 支持分数表示，分子和分母只能是整数。</li>
<li>如果是小数运算，结果也是小数，但小数计算的最后几位会不精确。</li>
<li>乘方函数和平方根函数</li>
<li>Racket 提供了三角函数和 <code>pi</code> 的定义，对，前面我们自己定义的 <code>pi</code>
离我们更近，所以把 Racket 提供的给覆盖了。</li>
<li>接下来两个函数是在精确值(整数、分数)和不精确值(小数)之间转换的。</li>
<li>一个数后面紧跟“e”再加一个整数表示科学计数法，比如 <code>1.23e5</code> 就是 1.23×10<sup>5</sup></li>
</ol>

<p>
还有很多各种各样的变量和函数可以使用，好奇的人请上网搜索或查<a href="https://docs.racket-lang.org/reference/generic-numbers.html">官方文档</a>，虽然我觉得如果是初学的话可能看不懂&#x2026;
</p>

<p>
最后，既然已经没的讲了，我就随便编一个 <code>sqrt</code> 函数，自己实现一个简单的开平方根的函数。我实在不想推导数学公式，你们会什么方法就用什么方法吧。</p>

<p>
比如我们要求 \(\sqrt{a}\)，我们设 \(f(x)=\cfrac{a+x^2}{2x}\)，然后随便取一个初始值，比如 1，然后一直调用 \(f\)，就像
\(f(f(f(...f(1))))\)，得到的结果就会越来越接近于 \(\sqrt{a}\)。(公式显示不出来的请反馈给我)
</p>

<p>
因为我们现在还没学更多的内容，我们只能让 <code>f</code> 接受两个参数，<code>a</code> 和 <code>x</code>，所以
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">f</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>a x<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">/</span> <span style="color: #97b098;">(</span><span style="color: #262680;">+</span> a <span style="color: #aebed8;">(</span><span style="color: #262680;">sqr</span> x<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
       <span style="color: #97b098;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">2</span> x<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
然后 <code>sqrt</code> 函数也很简单了，就是一直调用 <code>f</code> 而已
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">sqrt</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>a<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>f a <span style="color: #97b098;">(</span>f a <span style="color: #aebed8;">(</span>f a <span style="color: #b0b0b3;">(</span>f a <span style="color: #90a890;">(</span>f a <span style="color: #228b22;">1</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">tests</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">sqrt</span> <span style="color: #228b22;">4</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">926510094425921/463255047212960</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">exact-&gt;inexact</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">sqrt</span> <span style="color: #228b22;">4</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">2.000000000000002</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">exact-&gt;inexact</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">sqrt</span> <span style="color: #228b22;">2</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1.4142135623730951</span>
</pre>
</div>
<p>
可以看得出来，对于比较小的数，结果还是比较准确的。</p>

<p>
比较有意思的一点就是虽然 <code>f</code> 接受两个参数，但它们是有主次之分的，<code>a</code> 只是一个附加的材料，而 <code>x</code> 像是主要的产品，一直顺着 <code>f</code> 流动。你可以自己画一下图试试。</p>
</div>
</div>

<div id="outline-container-org0a3c59f" class="outline-2">
<h2 id="org0a3c59f">习题</h2>
<div class="outline-text-2" id="text-org0a3c59f">
<p>
目标: 能看懂这一章提到的语法，自己随便想几个简单的函数写一写。</p>

<p>
安装了 Racket 的人一定要亲手打代码啊
</p>

<p>
自己写一遍平方函数，在省略号中填空
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">sqr</span>
  ....<span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
同样，3次方和4次方
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">cube</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">3&#27425;&#26041;</span>
  ....<span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">power4-v1</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">4&#27425;&#26041;&#65292;&#29256;&#26412;1&#65292;&#21482;&#29992;&#20056;&#27861;</span>
  ....<span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">power4-v2</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#29256;&#26412;2&#65292;&#29992; sqr &#20989;&#25968;</span>
  ....<span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
(如果有谁想出来了4次方更好的名字，请告诉我一声)
</p>

<p>
测试一下
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>cube <span style="color: #228b22;">0</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">0</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>cube <span style="color: #228b22;">1.234</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1.879080904</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>cube <span style="color: #228b22;">10000</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1000000000000</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>cube <span style="color: #228b22;">-10</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">-1000</span>
......
......
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#27491;&#25968;&#12289;&#36127;&#25968;&#12289;&#25972;&#25968;&#12289;&#23567;&#25968;</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">power4 &#21516;&#29702;</span>
</pre>
</div>
<p>
虽然现在代码简单，这种测试确实没必要，这只是教你一个测试的好习惯，不要漏了什么<br />
(但其实说不定就发现自己哪里打错了)
</p>

<p>
把下面代码的图画出来
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>power4-v1 <span style="color: #228b22;">3</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">81</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>power4-v2 <span style="color: #228b22;">3</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">81</span>
</pre>
</div>
<p>
附加题: 假设每次乘法的时间相同，函数调用不需要时间，能看出效率的差异吗(就相当于比较乘法次数)？
如果是 <code>power8</code>，<code>power16</code>&#x2026; 呢？</p>

<p>
数学好的人很快就明白了吧，以后写了通用的乘方函数，再来详细地讨论这个问题。</p>

<hr />

<p>
还有一个值得深思的问题。</p>

<p>
来看一下这个函数
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">run-forever</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">()</span>
    <span style="color: #b0b1a3;">(</span>run-forever<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
你可以试验一下，请务必记得 DrRacket 的右上角 Run 按钮的边上，有个按钮叫 Stop。</p>

<p>
上面这个是下一章会讲的内容
</p>

<p>
最后是一个大概下下下章会讲的内容，很有趣的东西，先随便剧透一点。</p>

<p>
既然函数可以像数字一样传递，那是不是也可以作为函数的参数和返回值呢
</p>

<p>
举个例子，</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">value-at-100</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>f<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>f <span style="color: #228b22;">100</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
我们可以这样使用
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>value-at-100 <span style="color: #262680;">sqr</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">10000</span>
</pre>
</div>
<p>
这会有点颠覆你的想象，用它可以干很多有趣的事。</p>

<p>
又是个无限循环
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span>x x<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
   <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span>x x<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
手动模拟一下吧，应该会发现每次调用完了都是不变的，所以会无限循环。</p>

<p>
函数组合
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">compose</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>f g<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #97b098;">(</span>x<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>f g x<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">add1-and-sqr</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">compose</span> <span style="color: #262680;">sqr</span> <span style="color: #262680;">add1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>add1-and-sqr <span style="color: #228b22;">4</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">25</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#30456;&#24403;&#20110; (sqr (add1 4))</span>
</pre>
</div>
<p>
哈哈，现在看不懂无所谓，注意 <code>compose</code> 里的第一个 <code>λ</code>
是定义为 <code>compose</code> 的这个函数，第二个 <code>λ</code> 是函数输出的值。</p>

<p>
这只是最简单的。你信不信只用函数就可以实现数学的一切？从数字开始到各种数学运算，甚至逻辑运算(如果、与、或等)都能变成一个函数。感兴趣的参见 Church Decoding
</p>

<p>
剧透有点多了，就到这里了。</p>

<p>
(评论系统不太靠谱，我又删掉了，以后看情况再加吧)</p>
</div>
</div>
</div>
</body>
</html>