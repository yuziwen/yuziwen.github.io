<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-08-01 Thu 11:46 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PL教程 第一章 人和机器</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" type="text/css" href="css/worg.css"/>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">PL教程 第一章 人和机器</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orge7ae1e3">我们的机器</a></li>
<li><a href="#orge86655e">数字们</a></li>
<li><a href="#orge2aa5a4">圈养</a></li>
<li><a href="#org9a25a74">箱子</a></li>
<li><a href="#org8401cc6">降维打击</a></li>
<li><a href="#org7296d1d">在 Racket 中玩耍</a></li>
<li><a href="#org0a3c59f">习题</a></li>
</ul>
</div>
</div>

<div id="outline-container-orge7ae1e3" class="outline-2">
<h2 id="orge7ae1e3">我们的机器</h2>
<div class="outline-text-2" id="text-orge7ae1e3">
<p>
首先我得说，本来这些杂七杂八要放在前言里讲的，结果是&#x2026;
想说的话实在太多，前言已经尽可能地收敛了，还是不知不觉扯远了，
前言越到后面写的越跟编程没关系了。所以现在简单说说吧。
</p>

<p>
又要提 Dijkstra 的名言了
</p>
<blockquote>
<p>
教一群被 BASIC 语言先入为主的学生，什么是好的编程风格，
简直是一件不可能的事。对于一些有潜力的程序员，
他们受到的智力伤害远远超过了重建他们的信心。
</p>
</blockquote>
<p>
语言就是人表达的方式，语言塑造了人的世界。
</p>

<p>
受应试教育的绝对影响，很多人接触编程就是从算法竞赛开始的，
然后被老师灌输过他们的理论以后，理所当然地认为编程就是算法、数学。
当然，很多人跟不上进度便不学了，跟我一样，这是好事。
</p>

<p>
我现在也不知道这些误解到底是从哪来的，但我发现编程跟写作真的很像，
算法就是那些写作手法，数学可以比作一些特定的知识，比如历史。
你可以教小学生再多的手法和各种知识，但不要指望有人能写出好的故事。
</p>

<p>
原因在于，写作唯一的目的是表达自己的想法，编程就是为了解决问题。
要写一篇好文章，一些手法必不可少，但是重要的东西还有很多，
学习手法也要建立在文章写的清楚的基础上。另外，如果要写三国演义，
那必须精通历史，但也有很多时候用不着那么高深的历史。<br />
编程就是一样的道理。
</p>

<p>
程序语言理论(PLT，Programming Language Theory)就是对语言本身的研究，
它首先就教你写出简单的程序，建立信心。当然了，再深下去，
(虽然我挺喜欢的)，但对实际生活来说，没什么必要，
大多数人也不感兴趣。我只是想把最简单的东西讲一讲，
(因为稍微难一点的东西我不会)，普及一些正经的课程或书不会提到的东西，
讲一些刚学的时候很难理解，但理解以后会感觉“编程怎么这么简单”的知识。
顺便一提，我希望最后能让读者学会所有程序语言(共同特征和各自的优缺点)，
能学会发明自己的语言:p
</p>

<p>
语言的差距是很大的，我想尽量讲的简单，让人不要丧失太多的信心。
这就是这系列文章的目标。我还不知道我能不能做到。
</p>

<p>
给个例子吧，排序，大家都知道，但我一看见那两重循环就头疼，
直到我学了 Scheme 语言:
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: #93a8c6;">(</span><span style="color: black;">sort</span> ls<span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">if</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">null?</span> ls<span style="color: #b0b1a3;">)</span> <span style="color: #262680;">null</span>
      <span style="color: #b0b1a3;">(</span><span style="color: #262680;">let</span> <span style="color: #97b098;">(</span><span style="color: #aebed8;">[</span><span style="color: black;">m</span> <span style="color: #b0b0b3;">(</span><span style="color: #262680;">apply</span> <span style="color: #262680;">min</span> ls<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">]</span><span style="color: #97b098;">)</span>
        <span style="color: #97b098;">(</span><span style="color: #262680;">cons</span> m <span style="color: #aebed8;">(</span><span style="color: #262680;">sort</span> <span style="color: #b0b0b3;">(</span><span style="color: #262680;">remq</span> m ls<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
接触过的人肯定会有意见，但我不是想显示一下有多简单嘛，
第一行定义这个函数名叫 <code>sort</code>, 第二行处理空列表，第三行找最小值，
第四行递归进去。你跟别的语言比一比就知道了。
</p>

<p>
那是我第一次发现，写程序这么简单。就在那时我才对编程有了兴趣。
以前学算法都只是死学而已.
</p>

<p>
我也啃过那本著名的算法导论，说实话，我觉得真正能看下来的不是一般人。
为什么呢，那里面的代码&#x2026;实在是太恶心了。
我都只能看书上的图画，不看代码，
因为书上的代码复杂到没法看。真的。我是那种见到麻烦的东西就泄气的人，
比方说吧，我还记得书上红黑树的代码直到最后也没看下去，但是没关系，
因为我看到了一本 ML 语言的教材，它也讲到了红黑树，我一下子就明白了。
</p>

<p>
人使用的语言和接触的环境是会改变人的思考方式的。
</p>

<p>
追求简单就是我这些文章的目标，当然，只是尽量简单，
我不保证不动脑也能看懂。(动脑指的不是记忆，而是理解。)
</p>
<blockquote>
<p>
长期以来，有个事一直在困扰我，那就是越昂贵的，越是前沿的，
就越可能是没用的。然后，困扰我的另一个事是，电脑是一个死的机器，
却可以不可思议地完成那些巧妙的事情，而程序员是那么聪明的人，
却在做着不可思议的愚蠢的事情。简而言之，他们真是天生的一对。<br />
—— Bill Bryson
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orge86655e" class="outline-2">
<h2 id="orge86655e">数字们</h2>
<div class="outline-text-2" id="text-orge86655e">
<p>
首先，一个程序是什么?
</p>

<p>
举个例子吧，这是个什么也不干的程序:
</p>


<div class="figure">
<p><img src="./img/plt1/prog-id.png" alt="prog-id.png" />
</p>
</div>

<p>
你给它一个数字，它再还给你。我们的电脑可以储存整数和大概十几位的小数。
</p>

<p>
有了数字，那么计算是必须的。
</p>


<div class="figure">
<p><img src="./img/plt1/simple-calc.png" alt="simple-calc.png" />
</p>
</div>

<p>
可以看出来，写着加减乘除的方框是一个神秘的机器，
它吃进去两个数字，把结果吐出来。
</p>

<p>
这其实就是四个简单的程序，我们不用在乎它们对数字干了什么，
反正得到了想要的结果，应该相信它们。
</p>

<p>
程序当然不会这么简单，现在拿出纸(画图软件也行)，照着画一下
<code>1+2*3</code>, <code>(1+2)*(3+4)</code>, <code>1+2+3+4</code>
</p>

<p>
(谁也不能阻止你不画就往下看，但题目不是我随便写的，
请不要看得太快)
</p>

<p>
我认为总会有人遇到问题的。
</p>


<div class="figure">
<p><img src="./img/plt1/compound-calc.png" alt="compound-calc.png" />
</p>
</div>

<p>
首先，这些计算可以组合起来，需要留意的是，它们不是同时发生的，
计算 <code>1+2*3</code>, 首先是2和3进入乘法器里，等6出来之后，
它和1一起进入加法器。
</p>

<p>
第二个问题是， <code>(1+2)*(3+4)</code> 中，两个加法能否同时运行。
在学更多的东西之前，你可以认为，电脑里只有一个加法器，
它算完 <code>1+2</code> 之后，赶紧跑到下面去算 <code>3+4</code>, 然后3和7一起进入乘法。
你的头脑里只要有这个动画就行(当然，学了硬件以后就是另外一回事了)
</p>

<p>
最后一个就有些微妙，有人可能有不一样的结果，可能是 <code>(1+2)+(3+4)</code>
而不是 <code>((1+2)+3)+4</code>
</p>

<p>
计算机不允许有歧义，很多语言明确规定是我画的那种，从左向右组合，
有些语言随便来，就可能导致一些问题。比如有一个计数器，每次加1，
把两次结果相减。那我们就不能确定结果是 1 还是 -1 了。
但现在最好忘了这个东西，最好的办法就是永远不写这种代码，
一切问题就都没有了。(如果初学者看不懂请反映给我，考虑删掉这段)
</p>

<p>
思考题: 我们有没有漏某种情况?
</p>

<p>
虽然很烦人，但程序的问题就是这么出现的，考虑边边角角是个好习惯。
至少需要知道，一个数除以0会怎么样。
按照常识，程序会出错，就是这样。不多说了。
</p>
</div>
</div>

<div id="outline-container-orge2aa5a4" class="outline-2">
<h2 id="orge2aa5a4">圈养</h2>
<div class="outline-text-2" id="text-orge2aa5a4">
<p>
宠物多了就难管，数字多了也一样(瞎扯)
</p>

<p>
比方说，要计算复杂的公式，或者有重复的式子，比如 <code>1+2</code> 的平方:
</p>


<div class="figure">
<p><img src="./img/plt1/complex-sqr-1+2.png" alt="complex-sqr-1+2.png" />
</p>
</div>

<p>
画两遍 <code>1+2</code> 就有些麻烦(虽然我是复制粘贴..)，
还费时间费电，变量就出现了。<br />
先定义个变量 <code>three</code>, 然后让它平方。
(变量可以是字母，或减号、问号等规定的几个符号连在一起，
末尾可以跟数字，比如 <code>ab-cd-ef123</code>. 先不用太管这些)
</p>


<div class="figure">
<p><img src="./img/plt1/sqr-three.png" alt="sqr-three.png" />
</p>
</div>

<p>
变量跟加减乘除其实长得很像，确实是这样的，之后就会了解。
</p>

<p>
即使没有重复的计算，也应该适当使用变量，并给它取个好名字，
这样程序就更容易读懂了。
</p>

<p>
变量的名字对电脑来说无所谓，只要不重复就行，只是对人来说就不一样了。
</p>

<p>
这就是变量的两个用处: 储存、给人看。
</p>

<p>
当然，变量只能储存一个数字，总不能说要把一个程序塞进变量里吧。
</p>

<p>
关于变量其实就这么多。
</p>
</div>
</div>

<div id="outline-container-org9a25a74" class="outline-2">
<h2 id="org9a25a74">箱子</h2>
<div class="outline-text-2" id="text-org9a25a74">
<p>
数学老师讲过什么叫函数。也许是这么说的:<br />
<code>y=x+1</code><br />
这就是个函数。
</p>

<p>
可是在程序里就有点问题了，如果是这样:
</p>


<div class="figure">
<p><img src="./img/plt1/wrong-function.png" alt="wrong-function.png" />
</p>
</div>

<p>
那 <code>y</code> 只是个变量而已，如果这个程序的前面定义过 <code>x</code> 是多少，
那么 <code>y</code> 就是它加1，一个固定的数字，如果 <code>x</code> 没有定义过，那程序就出错。
</p>

<p>
那什么是函数呢，你可以想象成一个机器，有入口，有出口，
在内部对数字进行一些加工。简单来说，把 <code>x+1</code> 打个包就是个函数了。
</p>


<div class="figure">
<p><img src="./img/plt1/func-y=x+1.png" alt="func-y=x+1.png" />
</p>
</div>

<p>
它左右的两根线就是入口和出口，这个 <code>x</code> 被包在了函数里面，
然后被传给了一个加法器，(1就是凭空出现的)，然后把结果传出去。
</p>

<p>
我这里只是把它画成了透明的，实际中是看不到函数内部的，
所以我们给它贴了个名字叫 <code>add1</code>, 告诉我们这个函数的作用。
(叫它 y 或者 f 都可以，但因为这些名字没有意义，所以不推荐)
</p>

<p>
思考: 仔细对比之前学过的几幅图，你可能会发现什么。
</p>

<p>
第一个发现: 函数就是个小的程序，程序就是个函数。
它们长得是一样的。这告诉我们，一个程序的本质不是一行行代码，
它只不过是得到一些输入，按你的要求计算一些东西，然后输出而已。
(其实很早以前，函数(function)就被叫做子程序(subroutine))
</p>

<p>
第二个发现: 函数长得跟加减乘除一模一样。也就是说，
加减乘除其实就是函数! 你看，它们的概念也是一样的，
输入、加工、输出。编程中函数的定义更广了，函数可以有任意数量的输入，
而不只是一个。
</p>

<p>
从这里我们就大概能体会到函数存在的意义了，
在电脑中，一个加法都是很复杂的，你知道的，通过各种二进制的电路来实现，
但是你学编程，不需要知道电路是怎么样的，只要使用加法函数就可以，
那个加法函数的内部，其实是极其复杂的运算。
</p>

<p>
这就是函数的意义，它让你不用每次做加法都把复杂的计算写一遍，
而是一个加法函数搞定。你自己写的函数也是一样。
</p>

<p>
举个例子， <code>sqr</code> 函数是平方函数: sqr(x)=x<sup>2</sup>
</p>


<div class="figure">
<p><img src="./img/plt1/func-sqr.png" alt="func-sqr.png" />
</p>
</div>

<p>
这3个函数的作者分别是正常人，一个疯狂的黑客，还有一个存心坑你的人，
除了速度快慢，你并不能感觉出什么差异，反正你用的开心就可以。
在写大一些程序的时候，这个作用就体现出来了。
</p>

<p>
我啰嗦这么多，看起来很简单，可是确实这点容易被忽视。
刚开始学的时候，我们都没有把一块程序提取出来成为一个函数的意识，
我看过的很多代码，比如要算x<sup>2</sup> 还采用了第二种做法，
却不把它写成函数，看过去就是一大堆 &#x2026;&#x2026; x &#x2026;&#x2026; 
要费很大功夫才能看懂别人要干嘛。就因为这个，
很多教科书建议大家写注释，就是在旁边注一句“这段代码把x平方”。
可是只要写成函数，它自己就充当注释的作用了，这些麻烦就都没了。
(说这么多其实没啥用，考虑删掉这段)
</p>

<blockquote>
<p>
需要注意的是，没有那个好工程师会赞成写一个“摧毁巴克达”的函数。
最基本的职业规范告诉他们，应该去写一个叫“摧毁城市”的函数，
然后把“巴克达”当成这个函数的参数。<br />
—— Nathaniel S. Borenstein
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org8401cc6" class="outline-2">
<h2 id="org8401cc6">降维打击</h2>
<div class="outline-text-2" id="text-org8401cc6">
<p>
到现在我只画了图，因为那个图才是程序的含义，
现在有这样画画图就可以编程的语言，但我都不满意。
所以还是只能学要一行一行打代码的语言了。
画图多形象啊，为什么大家都喜欢写代码呢。
</p>

<p>
我费了好大的劲挑出来个语言叫 <a href="https://www.racket-lang.org">Racket</a>，虽然还是很不满意，但除了语法，
没有什么明显的缺点，只要不被它的括号吓跑的话&#x2026;
</p>

<p>
输入一个数字，Racket 就会原样输出。
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #228b22;">2333</span>
<span style="color: #228b22;">2333</span>
<span style="color: #262680;">&gt;</span> <span style="color: #228b22;">-123.456</span>
<span style="color: #228b22;">-123.456</span>
</pre>
</div>
<p>
一个大于号“&gt;”后面是我们的程序，之后是结果。
如果一行写不下可以换行。
</p>

<p>
这是加减乘除
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">3</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">-</span> <span style="color: #228b22;">3</span> <span style="color: #228b22;">2</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">6</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">/</span> <span style="color: #228b22;">10</span> <span style="color: #228b22;">2</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">5</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">7</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span><span style="color: #93a8c6;">)</span>
     <span style="color: #93a8c6;">(</span><span style="color: #262680;">-</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">/</span> <span style="color: #228b22;">4</span> <span style="color: #228b22;">2</span><span style="color: #b0b1a3;">)</span> <span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">3</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">+</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span><span style="color: #b0b1a3;">)</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span> <span style="color: #228b22;">4</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">10</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span> <span style="color: #228b22;">4</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">10</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">1</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">3</span> <span style="color: #228b22;">4</span> <span style="color: #228b22;">5</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">120</span>
</pre>
</div>
<p>
首先，加减乘除的格式是统一的，一对括号，括号中第一个是函数，
后面跟参数，用空格隔开。所以 <code>(+ 1 2)</code> 就是数学中的 <code>(1+2)</code><br />
函数可以嵌套，比如
</p>


<div class="figure">
<p><img src="./img/plt1/complex-arith.png" alt="complex-arith.png" />
</p>
</div>

<p>
放心，以后不会有这么复杂的代码了。<br />
(话说回来，也许代码比画图有个好处，因为代码稍微复杂点就看不清楚，
所以它逼着人们写简单的代码。)<br />
(但照这个逻辑下去，我们是不是应该都去写机器代码?)
</p>

<p>
数学中的函数是有优先级的，但 Racket 里没有，而且也不能省略括号或乘号，
也不能多加括号，因为 <code>(1)</code> 中的1的位置应该是一个函数，
但1不是函数，所以会出错。总之，就是完全的死板就对了。
</p>

<p>
最后是 Racket 提供的一个便利的写法，因为连续相加和相乘很常用，
所以加法和乘法可以有任意个参数。
</p>

<p>
这就是所有的数学内容。
</p>

<hr />

<p>
定义变量:
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">abc</span> <span style="color: #228b22;">123</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">this-is-a-variable</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">+</span> abc <span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> abc
<span style="color: #228b22;">123</span>
<span style="color: #262680;">&gt;</span> this-is-a-variable
<span style="color: #228b22;">124</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">abc</span> <span style="color: #228b22;">100</span><span style="color: #8c8c8c;">)</span>
&#20986;&#38169;&#65292;&#22240;&#20026;&#21464;&#37327;&#19981;&#33021;&#37325;&#22797;&#23450;&#20041;
</pre>
</div>
<p>
定义变量的语法是 <code>define</code>, 跟着要定义的变量的名字和它的值。
</p>

<p>
思考: <code>define</code> 是函数吗?
</p>

<p>
那要先看看函数是什么。
</p>

<p>
一个函数，在调用之前应该先计算它的参数，比如 <code>(+ (* 1 2) abc)</code>
(假设 <code>abc</code> 还是 123)，程序先计算 <code>(* 1 2)</code> 结果是2, <code>abc</code>
结果是123，然后再运行 <code>(+ 2 123)</code>
</p>

<p>
如果 <code>define</code> 是函数，那么比如 <code>(define x ...)</code> 需要先计算
<code>x</code> 的结果，但这时候 <code>x</code> 还没有定义。显然是不对的。
</p>

<p>
<code>define</code> 只是一个特殊的语法。它只是定义变量这个动作，
它也不像函数有一个输出。
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">m</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">define</span> <span style="color: black;">n</span> <span style="color: #228b22;">100</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
&#20986;&#38169;&#65292;&#22240;&#20026; <span style="color: #262680;">define</span> &#21482;&#26159;&#20010;&#21160;&#20316;&#65292;&#27809;&#26377;&#36755;&#20986;
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">+</span> <span style="color: #228b22;">1</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">define</span> <span style="color: black;">x</span> <span style="color: #228b22;">100</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
&#20986;&#38169;&#65292;&#21516;&#29702;
</pre>
</div>

<hr />

<p>
下面就是函数了。
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #93a8c6;">(</span>x<span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">+</span> x <span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
#&lt;procedure&gt;
</pre>
</div>
<p>
<code>λ</code> 开头是一个函数，接下来是一个括号，括号里是参数的名字，
再接下来是函数输出的值。很明显，λ也是个特殊语法。
</p>

<p>
顺便一提，它的结果是 <code>#&lt;procedure&gt;</code> 而不是原模原样的
<code>(λ (x) (+ x 1))</code>, 就是因为这个函数内部已经看不见了。
因此所有的函数在我们看来，都是一样的 <code>#&lt;procedure&gt;</code>
</p>

<p>
函数也可以有很多个参数，比如
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #93a8c6;">()</span> <span style="color: #228b22;">1</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">always 1</span>
#&lt;procedure&gt;
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #93a8c6;">(</span>x<span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">*</span> x x<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">square (&#24179;&#26041;)</span>
#&lt;procedure&gt;
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">pi</span> radius<span style="color: #93a8c6;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">area of circle (&#22278;&#38754;&#31215;)</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">*</span> <span style="color: #262680;">pi</span> radius radius<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
#&lt;procedure&gt;
</pre>
</div>
<p>
跟在分号后面，颜色不一样的是程序的注释，会被计算机忽略。
</p>

<p>
上面只是写了几个函数，但就像只写个数字一样，不把它定义给变量，
它就消失了。
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">always1</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">()</span> <span style="color: #228b22;">1</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">sqr</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> x x<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">circle-area</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">pi</span> radius<span style="color: #b0b1a3;">)</span>
      <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> <span style="color: #262680;">pi</span> radius radius<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#25110;&#32773; (* pi (sqr radius))</span>
</pre>
</div>
<p>
你可能又发现了，定义函数的语法跟定义变量是一样的，
只是后面跟数字还是函数的区别。
现在，变量的含义增加了。变量可以储存一个数字或者一个函数。
</p>

<p>
调用函数也是一样的，括号中第一个是函数，后面跟它们的参数
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>always1<span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1</span>
<span style="color: #262680;">&gt;</span> always1 <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#27880;&#24847;&#36319;&#19978;&#19968;&#20010;&#30340;&#21306;&#21035;</span>
#&lt;procedure:always1&gt;
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">sqr</span> <span style="color: #228b22;">3</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">9</span>
<span style="color: #262680;">&gt;</span> <span style="color: #262680;">sqr</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#25968;&#23398;&#19978;&#24635;&#26159;&#29992;(sqr x)&#34920;&#31034;&#36825;&#20010;&#20989;&#25968;&#65292;</span>
      <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#20320;&#20250;&#21457;&#29616;&#26159;&#22810;&#20040;&#38169;&#35823;&#30340;&#19968;&#20010;&#20889;&#27861;</span>
#&lt;procedure:sqr&gt;
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>circle-area <span style="color: #228b22;">3.14</span> <span style="color: #228b22;">10</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">314</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#31561;&#20215;&#20110;&#30452;&#25509;&#29992; &#955; &#26367;&#25442;</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">pi</span> radius<span style="color: #b0b1a3;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#26368;&#22806;&#38754;&#30340;&#25324;&#21495;&#26159;&#20989;&#25968;&#35843;&#29992;</span>
     <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> <span style="color: #262680;">pi</span> radius radius<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">&#955;&#22806;&#36824;&#26377;&#19968;&#23618;&#25324;&#21495;</span>
   <span style="color: #228b22;">3.14</span> <span style="color: #228b22;">10</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">314</span>
</pre>
</div>
<p>
就跟数字可以直接写出来一样，函数也可以直接用，只是看起来复杂。
</p>

<p>
我们定义和使用一个函数其实是这样的，它们在计算机中都只有一个，
但是存进变量以后，什么时候使用它，变量就把它拿出来，
跟拿出一个数字一样。
</p>


<div class="figure">
<p><img src="./img/plt1/define-use-func-sqr.png" alt="define-use-func-sqr.png" />
</p>
</div>

<p>
因为这么画太不方便，所以才画成函数上面贴个名字。
</p>

<p>
有人可能会好奇函数是怎么存进变量里的，答案就是，
变量存的其实还是个数字。<br />
地球上任意的位置都可以用数字(经纬度)表示，用 GPS 可以定位，
电脑里也是这样。函数也是一段程序，它在电脑里有一个地址，
这个地址就是个数字。我们要调用这个函数，只要知道它的地址，
就可以找到这段程序，然后运行，就是这么简单。
</p>

<hr />

<p>
最后的问题就是，函数参数的名字。
</p>

<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">x</span> <span style="color: #228b22;">1</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">f</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">+</span> x <span style="color: #228b22;">1</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">g</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">+</span> x <span style="color: #228b22;">2</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
大家都知道这3个 <code>x</code> 没有关联, <code>f</code> 和 <code>g</code> 的参数不会暴露在外面，
所以即使调用 <code>f</code> 和 <code>g</code> 也不会导致 <code>x</code> 被重新定义。
</p>


<div class="figure">
<p><img src="./img/plt1/name-conflict.png" alt="name-conflict.png" />
</p>
</div>

<p>
函数 <code>f</code> 和 <code>g</code> 中定义的 <code>x</code> 都在函数内部，电脑遵循就近原则(又是瞎扯)，
函数内有 <code>x</code> 了，就不去函数外找了。如果没有，再找函数外的，比如
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">h</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>y<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span><span style="color: #262680;">+</span> x y<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>h <span style="color: #228b22;">2</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">3</span>
</pre>
</div>

<div class="figure">
<p><img src="./img/plt1/outer-env.png" alt="outer-env.png" />
</p>
</div>

<p>
如果函数外也没定义 <code>x</code>, 那就只能出错了。
</p>

<p>
可以想一下这样做的好处。很多时候，程序里有很多很多变量，
比如用户名、密码或者各种常数，大一点的程序是很多人一起写的，
每个人都不知道别人到底定义了什么，要阻止重名是不可能的事了。
</p>

<p>
很容易想到的就是，我调用一个函数，如果我定义过了，那就先用我的，
不用管别人定义了什么。问题就解决了。
</p>

<p>
思考: 上面的做法有 bug，不知道你能不能看出来<br />
注: 这是一道超级难题。去看看历史就知道它花了科学家多长时间。
直到现在还有些语言有这个问题。<br />
提示: 调用 <code>h</code> 函数。
</p>

<p>
看看这个函数吧。
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">i</span>
    <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>x<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">(</span>h <span style="color: #228b22;">1</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span>i <span style="color: #228b22;">100</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">2</span> ? <span style="color: #228b22;">101</span> ?
</pre>
</div>
<p>
现在的问题来了, <code>h</code> 中的 <code>x</code> 到底是哪个 <code>x</code>, 是外界的变量
还是 <code>i</code> 的参数?
</p>

<p>
(你最好拿张纸把这几个函数抄一下，在纸上打打草稿，
不然来回翻页很麻烦)
</p>

<p>
照我们前面的解释，调用 <code>(i 100)</code> 之后，离 <code>h</code> 更近的 <code>x</code> 变成了100，
所以结果是101.
</p>

<p>
或者，因为 <code>h</code> 是 <code>(λ (y) (+ x y))</code>, 所以把 <code>h</code> 用它的值代换，
 <code>i</code> 就等价于
<code>(λ (x) ((λ (y) (+ x y)) 1))</code> (别费眼睛数括号了，知道怎么回事就行了)，
所以 <code>i</code> 变成了 <code>(λ (x) (+ x 1))</code>. 答案就神奇地变成了101
</p>

<p>
最古老的语言就都是这么做的，因为看起来理所当然。
</p>

<p>
但理所当然是不行的，对一个语言来说，实用才是关键。
所以还要看看它靠不靠谱。比如 <code>h</code> 是我写的，我为了方便，定义了个变量
<code>x</code>, 然后在 <code>h</code> 里用了 <code>x</code>, 然后把代码发给了你，
你上来就写了个 <code>i</code>, 你看了看, <code>i</code> 虽然有个参数 <code>x</code>, 但没用到，
所以应该永远是个定值 <code>(h 1)</code> 的。结果发现 <code>(i 10)</code> 是11，
<code>(i 100)</code> 是101，很不对是吧。都是 <code>(h 1)</code>, 结果居然不一样。
这还怎么写代码。
</p>

<p>
那我也很不爽啊，我好好地定义了个 <code>x</code>, 结果被你的给覆盖了。
</p>

<p>
(可能有人觉得，没人会定义 <code>x</code> 却不用，那我大不了就用一下呗，
比如把 <code>(h 1)</code> 改成 <code>(+ x (h 1))</code> 就好了。实际的例子暂时举不出，
但很多很多的，特别是黑客攻击的时候，简直相当于所有的代码都暴露给别人了)
</p>

<p>
事实已经证明了，这对一门语言来说绝对是个灾难。
</p>

<p>
于是有人发现，我们说“最近的变量”，不应该是在使用的时候，
而是在定义的时候。 <code>h</code> 在定义时, <code>x</code> 就是1，
那它就应该保存那个 <code>x</code>, 它的 <code>x</code> 就应该一直是1.
</p>

<p>
现在一个函数不只包含一段程序了，它还要包含它定义的时候，
所有用到的变量的地址。
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">...</span><span style="color: #93a8c6;">)</span> <span style="color: #262680;">...</span><span style="color: #8c8c8c;">)</span>
#&lt;procedure&gt;
</pre>
</div>
<p>
现在能理解为什么函数只会显示个 <code>#&lt;procedure&gt;</code> 了吧。
函数里包含了一堆东西，没法把它显示出来，只能用个 procedure 糊弄你一下。
但这确实就是函数的全部了。
</p>


<div class="figure">
<p><img src="./img/plt1/scoping-explain.png" alt="scoping-explain.png" />
</p>
</div>

<p>
现在再看看我们画的图，就不会出现这种问题。
很清楚，我们画下这个函数的时候，就已经确定了所有变量的来源。
实际上在图中，完全可以把变量的名字去掉，因为使用变量不需要通过名字，
只需要知道它在哪就可以(地址)，这就向机器语言又进了一步。
</p>

<p>
对于想知道术语的人: 现在的做法叫静态作用域(static scoping)
或词法作用域(lexical scoping)，过去的做法叫动态作用域(dynamic scoping).
因为过去变量是在函数调用的时候找的，是“动态”查找的。
现在定义时候变量就确定了，是“静态”的。
</p>
</div>
</div>

<div id="outline-container-org7296d1d" class="outline-2">
<h2 id="org7296d1d">在 Racket 中玩耍</h2>
<div class="outline-text-2" id="text-org7296d1d">
<p>
这章讲如何安装 Racket. 懒得搞这些东西的话可以直接跳过。
</p>

<p>
我故意跟别的教材不一样，其它的书都先让人安装各种软件，
这样就可以在电脑上一边看书一边试验了，这是好事。
但是，我发现一直待在电脑前，让我养成了一个很坏的习惯:
当我思路还没理清楚时，就迫不及待地想到哪写到哪，
最后把整个程序搞得很糟，只能反复找 bug. 相反，
如果我手头没有电脑，我就只能在纸上打草稿，
就不那么容易随便修改，所以必须让程序在脑子里完全成型了再写下来，
最后把它打到电脑里，一次性就是完全正确的。
</p>

<p>
电脑本来就只是辅助你运行程序的，如果自己没有完全理清思路，
就不要指望电脑能得出正确的结果。
</p>

<p>
还要说的是，你用什么样的电脑，什么操作系统，你的打字速度，
都是没有关系的。一定要用你最熟悉的操作系统，
或者你的朋友用啥你就用啥。我看到有些教程一上来就让你装 Linux 和
各种开发环境，有人折腾半天还没开始编程，这是很糟糕的。
(但是如果你还在用 Windows XP，我无法保证你能安装，因为太老了，
建议换个新操作系统吧。)
</p>

<p>
首先，Racket 官网是这个 <a href="https://www.racket-lang.org">https://www.racket-lang.org</a>，
你也可以直接去下载页面 <a href="https://download.racket-lang.org">https://download.racket-lang.org</a>，
默认下载就可以。如果你不熟悉，一路默认安装就可以，
安装完以后你的桌面上就会出现 DrRacket 的快捷方式了。
(使用 Ubuntu 的可以直接通过 apt 安装 <code>sudo apt install racket</code> ，
DrRacket 会添加在你的桌面应用里面。
当然也可以用 Emacs 来编辑 Racket，我一直用的是 racket-mode，
自己稍稍配置一下 paredit 什么的，用起来还是过得去的。)
</p>

<p>
打开 DrRacket 以后，首先就在文件里打一行 <code>#lang racket</code> ，
然后应该就可以写代码了。具体不会操作的请直接上网搜，
如何安装/使用 DrRacket
</p>

<p>
然后一定要记得切换到英文输入法，因为中英文的标点符号都是不一样的。
</p>

<p>
接下来就可以玩耍了。
</p>

<p>
在 <b>定义窗口</b> 写一些变量定义，然后点屏幕右上角的 run 或者按 F5 ，
就可以运行定义的内容，然后在 <b>交互窗口</b> 输入一些东西的计算。
(具体怎么操作网上有详细教程)
</p>

<p>
总共就这些要讲的，但如果你觉得不够，我就再说一些杂七杂八的内容。
这些不要记，知不知道都无所谓，就当了解一下了。
</p>

<p>
先说一些数字计算
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">/</span> <span style="color: #228b22;">7</span> <span style="color: #228b22;">3</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">7/3</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">/</span> <span style="color: #228b22;">7</span> <span style="color: #228b22;">3.0</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">2.3333333333333335</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">expt</span> <span style="color: #228b22;">2</span> <span style="color: #228b22;">100</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">the 100th power of 2</span>
<span style="color: #228b22;">10715086071862673209484250490600018105614048117055336074437503883703510511249361224931983788156958581275946729175531468251871452856923140435984577574698574803934567774824230985421074605062371141877954182153046474983581941267398767559165543946077062914571196477686542167660429831652624386837205668069376</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">sqrt</span> <span style="color: #228b22;">2</span><span style="color: #8c8c8c;">)</span> <span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">square root</span>
<span style="color: #228b22;">1.4142135623730951</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">cos</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">/</span> <span style="color: #262680;">pi</span> <span style="color: #228b22;">3</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">0.5000000000000001</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">exact-&gt;inexact</span> <span style="color: #228b22;">7/3</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">2.3333333333333335</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">inexact-&gt;exact</span> <span style="color: #228b22;">2.3333333333333335</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">5254199565265579/2251799813685248</span>
<span style="color: #262680;">&gt;</span> 1.23e5
<span style="color: #228b22;">123000.0</span>
<span style="color: #262680;">&gt;</span> <span style="color: #228b22;">2e20</span>
<span style="color: #228b22;">2e+20</span>
<span style="color: #262680;">&gt;</span> <span style="color: #228b22;">2e-4</span>
<span style="color: #228b22;">0.0002</span>
</pre>
</div>
<ol class="org-ol">
<li>Racket 支持分数表示，但分子和分母只能是整数。</li>
<li>如果是小数运算，结果也是小数，但小数计算的最后几位都会不精确。</li>
<li>次方函数和平方根函数</li>
<li>Racket 提供了三角函数和 <code>pi</code> 的定义。</li>
<li>接下来两个函数是在精确值和不精确值之间转换的。</li>
<li>一个数后面紧跟“e”再加一个整数表示科学计数法，
比如 <code>1.23e5</code> 就是 1.23×10<sup>5</sup></li>
</ol>

<p>
还有很多各种各样的变量和函数可以使用，具体请上网搜索或查<a href="https://docs.racket-lang.org">官方文档</a>。
</p>

<p>
最后，既然已经没的讲了，我就随便编一个 <code>sqrt</code> 函数，
自己实现一个简单的开平方根的函数。我实在不想推导数学公式，
你们会什么方法就用什么方法，我不想在这说，反正你们只要知道结果就行了。
</p>

<p>
比如我们要求 \(\sqrt{a}\) ，我们设 \(f(x)=\cfrac{a+x^2}{2x}\) ，
然后随便取一个初始值，比如 1，然后一直调用 \(f\) ，就像
\(f(f(f(...f(1))))\) ，得到的结果就会越来越接近于 \(\sqrt{a}\) 。
</p>

<p>
因为我们现在还没学更多的内容，我们只能让 <code>f</code> 接受两个参数，
<code>a</code> 和 <code>x</code> ，所以
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">f</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>a x<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">/</span> <span style="color: #97b098;">(</span><span style="color: #262680;">+</span> a <span style="color: #aebed8;">(</span><span style="color: #262680;">sqr</span> x<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
       <span style="color: #97b098;">(</span><span style="color: #262680;">*</span> <span style="color: #228b22;">2</span> x<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
<p>
然后 <code>sqrt</code> 函数也很简单了，就是一直调用 <code>f</code> 而已
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">sqrt</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>a<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>f a <span style="color: #97b098;">(</span>f a <span style="color: #aebed8;">(</span>f a <span style="color: #b0b0b3;">(</span>f a <span style="color: #90a890;">(</span>f a <span style="color: #228b22;">1</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #ff7f24;">;; </span><span style="color: #ff7f24;">tests</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">sqrt</span> <span style="color: #228b22;">4</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">926510094425921/463255047212960</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">exact-&gt;inexact</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">sqrt</span> <span style="color: #228b22;">4</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">2.000000000000002</span>
<span style="color: #262680;">&gt;</span> <span style="color: #8c8c8c;">(</span><span style="color: #262680;">exact-&gt;inexact</span> <span style="color: #93a8c6;">(</span><span style="color: #262680;">sqrt</span> <span style="color: #228b22;">2</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #228b22;">1.4142135623730951</span>
</pre>
</div>
<p>
可以看得出来，对于比较小的数，结果还是比较准确的。
</p>

<p>
比较有意思的一点就是虽然 <code>f</code> 接受两个参数，但它们是有主次之分的，
<code>a</code> 只是一个附加的材料，而 <code>x</code> 像是主要的产品，一直顺着 <code>f</code> 流动。
你可以自己画一下图试试。
</p>
</div>
</div>

<div id="outline-container-org0a3c59f" class="outline-2">
<h2 id="org0a3c59f">习题</h2>
<div class="outline-text-2" id="text-org0a3c59f">
<p>
能看懂这一章提到的语法，自己随便想几个简单的函数写一写。
</p>

<p>
注: 前面写的圆面积的函数不是很好，因为 π 一般作为一个常数，
会定义成一个变量，而不是每次作为参数。
</p>
<div class="org-src-container">
<pre class="src src-racket"><span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">pi</span> <span style="color: #228b22;">3.14</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #262680;">define</span> <span style="color: black;">circle-area</span>
  <span style="color: #93a8c6;">(</span><span style="color: #262680;">&#955;</span> <span style="color: #b0b1a3;">(</span>radius<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #262680;">*</span> <span style="color: #262680;">pi</span> <span style="color: #97b098;">(</span><span style="color: #262680;">sqr</span> radius<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
</div>
</div>
</div>
</body>
</html>